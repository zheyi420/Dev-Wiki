***The Modern JavaScript Tutorial***
> https://javascript.info/


# PART 1 The JavaScript language



## 1 - An introduction



### 1.1 Intro

- è¿™ç§ç¼–ç¨‹è¯­è¨€å†™å‡ºæ¥çš„ç¨‹åºè¢«ç§°ä¸ºÂ **è„šæœ¬**ã€‚å®ƒä»¬å¯ä»¥è¢«ç›´æ¥å†™åœ¨ç½‘é¡µçš„ HTML ä¸­ï¼Œåœ¨é¡µé¢åŠ è½½çš„æ—¶å€™è‡ªåŠ¨æ‰§è¡Œã€‚è„šæœ¬è¢«ä»¥çº¯æ–‡æœ¬çš„å½¢å¼æä¾›å’Œæ‰§è¡Œã€‚å®ƒä»¬ä¸éœ€è¦ç‰¹æ®Šçš„å‡†å¤‡æˆ–ç¼–è¯‘å³å¯è¿è¡Œã€‚
- JavaScript ä¸ä»…å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œç”šè‡³å¯ä»¥åœ¨ä»»æ„æ­è½½äº†Â [JavaScript å¼•æ“](https://zh.wikipedia.org/wiki/JavaScript%E5%BC%95%E6%93%8E) çš„è®¾å¤‡ä¸­æ‰§è¡Œã€‚æµè§ˆå™¨ä¸­åµŒå…¥äº† JavaScript å¼•æ“ï¼Œæœ‰æ—¶ä¹Ÿç§°ä½œâ€œJavaScript è™šæ‹Ÿæœºâ€ã€‚
- ç°ä»£çš„ JavaScript æ˜¯ä¸€ç§â€œå®‰å…¨çš„â€ç¼–ç¨‹è¯­è¨€ã€‚å®ƒä¸æä¾›å¯¹å†…å­˜æˆ– CPU çš„åº•å±‚è®¿é—®ï¼Œå› ä¸ºå®ƒæœ€åˆæ˜¯ä¸ºæµè§ˆå™¨åˆ›å»ºçš„ï¼Œä¸éœ€è¦è¿™äº›åŠŸèƒ½ã€‚ï¼ˆä½†æ˜¯ç°åœ¨ä¹Ÿè¢«ç”¨äºå¾ˆå¤šå…¶ä»–çš„ç¯å¢ƒã€‚å¦‚æœåŠ¡å™¨ï¼Œæ‰‹æœºåº”ç”¨ã€‚ï¼‰
- JavaScript çš„èƒ½åŠ›å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºå®ƒè¿è¡Œçš„ç¯å¢ƒã€‚ä¾‹å¦‚ï¼ŒNode.jsÂ æ”¯æŒå…è®¸ JavaScript è¯»å–/å†™å…¥ä»»æ„æ–‡ä»¶ï¼Œæ‰§è¡Œç½‘ç»œè¯·æ±‚ç­‰çš„å‡½æ•°ã€‚
- ä¸ºäº†ç”¨æˆ·çš„ï¼ˆä¿¡æ¯ï¼‰å®‰å…¨ï¼Œåœ¨æµè§ˆå™¨ä¸­çš„ JavaScript çš„èƒ½åŠ›æ˜¯å—é™çš„ã€‚åŒ…æ‹¬é™åˆ¶è®¿é—®æœ¬åœ°æ–‡ä»¶ï¼Œæ— æ³•è®¿é—®æ“ä½œç³»ç»Ÿï¼Œâ€œåŒæºç­–ç•¥â€é™åˆ¶ï¼Œé™åˆ¶ä»éå½“å‰é¡µé¢æ‰€åœ¨æœåŠ¡å™¨ä¸­æ¥æ”¶æ•°æ®ï¼Œç­‰ç­‰ã€‚å¦‚æœåœ¨æµè§ˆå™¨ç¯å¢ƒå¤–ï¼ˆä¾‹å¦‚åœ¨æœåŠ¡å™¨ä¸Šï¼‰ä½¿ç”¨ JavaScriptï¼Œåˆ™ä¸å­˜åœ¨æ­¤ç±»é™åˆ¶ã€‚
- **å¼•æ“æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ**
  
    > å¼•æ“å¾ˆå¤æ‚ï¼Œä½†æ˜¯åŸºæœ¬åŸç†å¾ˆç®€å•ã€‚
    > 
    > 1. å¼•æ“ï¼ˆå¦‚æœæ˜¯æµè§ˆå™¨ï¼Œåˆ™å¼•æ“è¢«åµŒå…¥åœ¨å…¶ä¸­ï¼‰è¯»å–ï¼ˆâ€œè§£æâ€ï¼‰è„šæœ¬ã€‚
    > 2. ç„¶åï¼Œå¼•æ“å°†è„šæœ¬è½¬åŒ–ï¼ˆâ€œç¼–è¯‘â€ï¼‰ä¸ºæœºå™¨è¯­è¨€ã€‚
    > 3. ç„¶åï¼Œæœºå™¨ä»£ç å¿«é€Ÿåœ°æ‰§è¡Œã€‚
    > 
    > å¼•æ“ä¼šå¯¹æµç¨‹ä¸­çš„æ¯ä¸ªé˜¶æ®µéƒ½è¿›è¡Œä¼˜åŒ–ã€‚å®ƒç”šè‡³å¯ä»¥åœ¨ç¼–è¯‘çš„è„šæœ¬è¿è¡Œæ—¶ç›‘è§†å®ƒï¼Œåˆ†ææµç»è¯¥è„šæœ¬çš„æ•°æ®ï¼Œå¹¶æ ¹æ®è·å¾—çš„ä¿¡æ¯è¿›ä¸€æ­¥ä¼˜åŒ–æœºå™¨ä»£ç ã€‚
    > 





### 1.2 Manuals and specifications

- **[ECMA-262 è§„èŒƒ](https://www.ecma-international.org/publications-and-standards/standards/ecma-262/)**Â åŒ…å«äº†å¤§éƒ¨åˆ†æ·±å…¥çš„ã€è¯¦ç»†çš„ã€è§„èŒƒåŒ–çš„å…³äº JavaScript çš„ä¿¡æ¯ã€‚è¿™ä»½è§„èŒƒæ˜ç¡®åœ°å®šä¹‰äº†è¿™é—¨è¯­è¨€ã€‚
- **[MDNï¼ˆMozillaï¼‰JavaScript ç´¢å¼•](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference)**Â æ˜¯ä¸€ä¸ªå¸¦æœ‰ç”¨ä¾‹å’Œå…¶ä»–ä¿¡æ¯çš„ä¸»è¦çš„æ‰‹å†Œã€‚å®ƒæ˜¯ä¸€ä¸ªè·å–å…³äºä¸ªåˆ«è¯­è¨€å‡½æ•°ã€æ–¹æ³•ç­‰æ·±å…¥ä¿¡æ¯çš„å¾ˆå¥½çš„ä¿¡æ¯æ¥æºã€‚
- å…¼å®¹æ€§è¡¨
    - [https://kangax.github.io/compat-table](https://kangax.github.io/compat-table) ECMAScript ç‰ˆæœ¬å…¼å®¹æ€§è¡¨ï¼Œä¸€ä»½åˆ—æœ‰è¯­è¨€åŠŸèƒ½ä»¥åŠå¼•æ“æ˜¯å¦æ”¯æŒè¿™äº›åŠŸèƒ½çš„è¡¨æ ¼ï¼ˆå¯æŸ¥çœ‹ç”¨æˆ·å½“å‰æµè§ˆå™¨ã€ä½¿ç”¨çš„ js ç¼–è¯‘å™¨å¦‚ node çš„æ”¯æŒåŠŸèƒ½ï¼‰
    - [https://caniuse.com/](https://caniuse.com/) æŸ¥çœ‹æµè§ˆå™¨å¯ç”¨çš„åŠŸèƒ½ï¼Œæ¯ä¸ªåŠŸèƒ½çš„æ”¯æŒè¡¨ï¼ˆç°ä»£ç½‘ç»œæŠ€æœ¯çš„æµè§ˆå™¨æ”¯æŒè¡¨ï¼‰





### 1.3 Code editors

- IDE - Integrated development environment - é›†æˆå¼€å‘ç¯å¢ƒ
  
    e.g. [VS Code](https://code.visualstudio.com/), [WebStorm](https://www.jetbrains.com/webstorm/)
    
- è½»é‡ç¼–è¾‘å™¨
  
    e.g. [Sublime Text](http://www.sublimetext.com/), [Notepad++](https://notepad-plus-plus.org/), [Vim](http://www.vim.org/), [Emacs](https://www.gnu.org/software/emacs/)
    





### 1.4 Developer console

*omitted*





## 2 - JavaScript Fundamentals



### 2.1 Hello, world!

*omitted*





### 2.2 Code structure

- **è¯­å¥** - è¯­å¥æ˜¯æ‰§è¡Œè¡Œä¸ºï¼ˆactionï¼‰çš„è¯­æ³•ç»“æ„å’Œå‘½ä»¤ã€‚
- **åˆ†å·** - å½“å­˜åœ¨æ¢è¡Œç¬¦ï¼ˆline breakï¼‰æ—¶ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥çœç•¥åˆ†å·ã€‚åœ¨è¿™ï¼ŒJavaScript å°†æ¢è¡Œç¬¦ç†è§£æˆâ€œéšå¼â€çš„åˆ†å·ã€‚è¿™ä¹Ÿè¢«ç§°ä¸ºÂ [è‡ªåŠ¨åˆ†å·æ’å…¥](https://tc39.github.io/ecma262/#sec-automatic-semicolon-insertion)ã€‚
  
    ä»æœ‰å¾ˆå¤šæ¢è¡Œä¸æ˜¯åˆ†å·çš„ä¾‹å­ï¼Œä¹Ÿå­˜åœ¨ JavaScript æ— æ³•ç¡®å®šæ˜¯å¦çœŸçš„éœ€è¦è‡ªåŠ¨æ’å…¥åˆ†å·çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µä¸‹å‘ç”Ÿçš„é”™è¯¯æ˜¯å¾ˆéš¾è¢«æ‰¾åˆ°å’Œè§£å†³çš„ã€‚
    
    å› æ­¤ï¼Œå³ä½¿è¯­å¥è¢«æ¢è¡Œç¬¦åˆ†éš”äº†ï¼Œæˆ‘ä»¬ä¾ç„¶å»ºè®®åœ¨å®ƒä»¬ä¹‹é—´åŠ åˆ†å·ã€‚
    
- **æ³¨é‡Š** - *omitted*





### 2.3 The modern mode, "use strict"

2009 å¹´ ECMAScript 5 (ES5) è§„èŒƒå‡ºç°ã€‚å¢åŠ äº†æ–°çš„è¯­è¨€ç‰¹æ€§å¹¶ä¸”ä¿®æ”¹äº†ä¸€äº›å·²ç»å­˜åœ¨çš„ç‰¹æ€§ã€‚

ä¸ºäº†ä¿è¯æ—§çš„åŠŸèƒ½èƒ½å¤Ÿä½¿ç”¨ï¼Œå¤§éƒ¨åˆ†çš„ä¿®æ”¹æ˜¯é»˜è®¤ä¸ç”Ÿæ•ˆçš„ã€‚ä½ éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„æŒ‡ä»¤ â€”â€”Â `"use strict"` æ¥æ˜ç¡®åœ°æ¿€æ´»è¿™äº›ç‰¹æ€§ã€‚

- å½“å­—ç¬¦ä¸²`"use strict"`æˆ–è€…`'use strict'`å¤„äºè„šæœ¬æ–‡ä»¶çš„é¡¶éƒ¨æ—¶ï¼ˆåªæœ‰æ³¨é‡Šå¯ä»¥å‡ºç°åœ¨Â `"use strict"`Â çš„ä¸Šé¢ï¼‰ï¼Œæ•´ä¸ªè„šæœ¬æ–‡ä»¶éƒ½å°†ä»¥â€œç°ä»£â€æ¨¡å¼è¿›è¡Œå·¥ä½œã€‚
- `"use strict"` å¯ä»¥è¢«æ”¾åœ¨å‡½æ•°ä½“çš„å¼€å¤´ã€‚è¿™æ ·åˆ™å¯ä»¥åªåœ¨è¯¥å‡½æ•°ä¸­å¯ç”¨ä¸¥æ ¼æ¨¡å¼ã€‚ä½†é€šå¸¸äººä»¬ä¼šåœ¨æ•´ä¸ªè„šæœ¬ä¸­å¯ç”¨ä¸¥æ ¼æ¨¡å¼ã€‚
- æ²¡æœ‰ç±»ä¼¼äºÂ `"no use strict"`Â è¿™æ ·çš„æŒ‡ä»¤å¯ä»¥ä½¿ç¨‹åºè¿”å›é»˜è®¤æ¨¡å¼ã€‚ä¸€æ—¦è¿›å…¥äº†ä¸¥æ ¼æ¨¡å¼ï¼Œå°±æ²¡æœ‰å›å¤´è·¯äº†ã€‚
- åœ¨æµè§ˆå™¨å¼€å‘è€…æ§åˆ¶å°å¯ç”¨`"use strict"`ï¼šå¤šè¡Œä»£ç çš„è¾“å…¥æ–¹å¼ï¼Œå¹¶å°†`"use strict"` æ”¾åœ¨ä»£ç æœ€é¡¶ç«¯ã€‚æˆ–ä½¿ç”¨ ES5 çš„è¯­æ³•ï¼Œå°†ä»£ç æ”¾åœ¨åŒ…è£…å™¨ä¸­ï¼Œ`"use strict"` æ”¾åœ¨ä»£ç å¤´å‰ã€‚
- ç°ä»£ JavaScript æ”¯æŒ â€œclassâ€ å’Œ â€œmoduleâ€ â€”â€” é«˜çº§è¯­è¨€ç»“æ„ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨å¯ç”¨Â `use strict`ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨å®ƒä»¬ï¼Œåˆ™æ— éœ€æ·»åŠ Â `"use strict"`Â æŒ‡ä»¤ã€‚





### 2.4 Variables

- **å˜é‡å‘½å**
  
    ä¸€ä¸ªå˜é‡ååº”è¯¥æœ‰ä¸€ä¸ªæ¸…æ™°ã€æ˜æ˜¾çš„å«ä¹‰ï¼Œå¯¹å…¶å­˜å‚¨çš„æ•°æ®è¿›è¡Œæè¿°ã€‚
    
    å¦‚æœå‘½ååŒ…æ‹¬å¤šä¸ªå•è¯ï¼Œé€šå¸¸é‡‡ç”¨é©¼å³°å¼å‘½åæ³•ï¼ˆ[camelCase](https://en.wikipedia.org/wiki/CamelCase)ï¼‰ã€‚
    
    JavaScript çš„å˜é‡å‘½åæœ‰ä¸¤ä¸ªé™åˆ¶ï¼š
    
    - å˜é‡åç§°å¿…é¡»ä»…åŒ…å«ï¼šå­—æ¯ã€æ•°å­—ã€ç¬¦å·Â `$`Â å’ŒÂ `_`ã€‚
    - é¦–å­—ç¬¦å¿…é¡»éæ•°å­—ã€‚
    
    :information_source:æ³¨æ„ï¼š
    
    - å˜é‡ååŒºåˆ†å¤§å°å†™ï¼Œå‘½åä¸ºÂ `apple`Â å’ŒÂ `APPLE`Â çš„å˜é‡æ˜¯ä¸åŒçš„ä¸¤ä¸ªå˜é‡ã€‚
    - å…è®¸éè‹±æ–‡å­—æ¯ï¼Œè¥¿é‡Œå°”å­—æ¯ç”šè‡³è±¡å½¢æ–‡å­—ï¼ˆæ±‰å­—ï¼‰éƒ½æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œä½†ä¸å»ºè®®ã€‚
    
    :warning:è­¦å‘Šï¼š
    
    - æœ‰ä¸€å¼ Â [ä¿ç•™å­—åˆ—è¡¨](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Lexical_grammar#Keywords)ï¼Œè¿™å¼ è¡¨ä¸­çš„ä¿ç•™å­—æ— æ³•ç”¨ä½œå˜é‡å‘½åï¼Œå› ä¸ºå®ƒä»¬è¢«ç”¨äºç¼–ç¨‹è¯­è¨€æœ¬èº«äº†ã€‚
    - æœªé‡‡ç”¨Â `use strict`Â ä¸‹çš„èµ‹å€¼ï¼šåœ¨æ—©æœŸï¼Œæˆ‘ä»¬å¯ä»¥ä¸ä½¿ç”¨Â `let`Â è¿›è¡Œå˜é‡å£°æ˜ï¼Œè€Œå¯ä»¥ç®€å•åœ°é€šè¿‡èµ‹å€¼æ¥åˆ›å»ºä¸€ä¸ªå˜é‡ã€‚ç°åœ¨å¦‚æœæˆ‘ä»¬ä¸åœ¨è„šæœ¬ä¸­ä½¿ç”¨Â `use strict`Â å£°æ˜å¯ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œè¿™ä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œè¿™æ˜¯ä¸ºäº†ä¿æŒå¯¹æ—§è„šæœ¬çš„å…¼å®¹ã€‚
    
- **å¸¸é‡**
  
    - ä½¿ç”¨`const`å£°æ˜çš„å˜é‡ç§°ä¸ºâ€œå¸¸é‡â€ã€‚å®ƒä»¬ä¸èƒ½è¢«ä¿®æ”¹ï¼Œå¦‚æœä½ å°è¯•ä¿®æ”¹å°±ä¼šå‘ç°æŠ¥é”™ã€‚
    - ä¸€ä¸ªæ™®éçš„åšæ³•æ˜¯å°†å¸¸é‡ç”¨ä½œåˆ«åï¼Œä»¥ä¾¿è®°ä½é‚£äº›åœ¨æ‰§è¡Œä¹‹å‰å°±å·²çŸ¥çš„éš¾ä»¥è®°ä½çš„å€¼ã€‚ä½¿ç”¨å¤§å†™å­—æ¯å’Œä¸‹åˆ’çº¿æ¥å‘½åè¿™äº›å¸¸é‡ã€‚e.g.`const COLOR_RED = "#F00";`
    - ä½œä¸ºä¸€ä¸ªâ€œå¸¸æ•°â€ï¼Œæ„å‘³ç€å€¼æ°¸è¿œä¸å˜ã€‚ä½†æ˜¯æœ‰äº›å¸¸é‡åœ¨æ‰§è¡Œä¹‹å‰å°±å·²çŸ¥äº†ï¼ˆæ¯”å¦‚çº¢è‰²çš„åå…­è¿›åˆ¶å€¼ï¼‰ï¼Œè¿˜æœ‰äº›åœ¨æ‰§è¡ŒæœŸé—´è¢«â€œè®¡ç®—â€å‡ºæ¥ï¼Œä½†åˆå§‹èµ‹å€¼ä¹‹åå°±ä¸ä¼šæ”¹å˜ã€‚
    - ä»€ä¹ˆæ—¶å€™è¯¥ä¸ºå¸¸é‡ä½¿ç”¨å¤§å†™å‘½åï¼Œä»€ä¹ˆæ—¶å€™è¿›è¡Œå¸¸è§„å‘½åï¼Ÿ
        - å¤§å†™å‘½åçš„å¸¸é‡ä»…ç”¨ä½œâ€œç¡¬ç¼–ç ï¼ˆhard-codedï¼‰â€å€¼çš„åˆ«åã€‚
        - `const pageLoadTime = /* ç½‘é¡µåŠ è½½æ‰€éœ€çš„æ—¶é—´ */;` `pageLoadTime`çš„å€¼åœ¨é¡µé¢åŠ è½½ä¹‹å‰æ˜¯æœªçŸ¥çš„ï¼Œæ‰€ä»¥é‡‡ç”¨å¸¸è§„å‘½åã€‚ä½†æ˜¯å®ƒä»ç„¶æ˜¯ä¸ªå¸¸é‡ï¼Œå› ä¸ºèµ‹å€¼ä¹‹åä¸ä¼šæ”¹å˜ã€‚





### 2.5 Data types

- å¯ä»¥å°†ä»»ä½•ç±»å‹çš„å€¼å­˜å…¥å˜é‡ï¼Œå…è®¸è¿™ç§æ“ä½œçš„ç¼–ç¨‹è¯­è¨€ï¼Œä¾‹å¦‚ JavaScriptï¼Œè¢«ç§°ä¸ºâ€œåŠ¨æ€ç±»å‹â€ï¼ˆdynamically typedï¼‰çš„ç¼–ç¨‹è¯­è¨€ï¼Œæ„æ€æ˜¯è™½ç„¶ç¼–ç¨‹è¯­è¨€ä¸­æœ‰ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œä½†æ˜¯ä½ å®šä¹‰çš„å˜é‡å¹¶ä¸ä¼šåœ¨å®šä¹‰åï¼Œè¢«é™åˆ¶ä¸ºæŸä¸€æ•°æ®ç±»å‹ã€‚
- JavaScript ä¸­çš„å…«ç§åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼ˆä¸ƒç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä¹Ÿç§°ä¸ºåŸå§‹æ•°æ®ç±»å‹ã€‚ä¸€ç§å¼•ç”¨ç±»å‹ï¼Œå³ `object`ï¼Œæ˜¯å¤æ‚æ•°æ®ç±»å‹ï¼‰ã€‚



*details:* 

- [[MDN] JavaScript types](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#javascript_types)
- [[MDN] Data types](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Language_overview#data_types)



#### seven *primitive types*

##### `Number`

ç”¨äºä»»ä½•ç±»å‹çš„æ•°å­—ï¼šå¸¸è§„çš„æ•°å­—ï¼šæ•´æ•°æˆ–æµ®ç‚¹æ•°ï¼Œåœ¨Â `Â±(2^53 - 1)`Â èŒƒå›´å†…çš„æ•´æ•°ã€‚è¿˜åŒ…æ‹¬â€œç‰¹æ®Šæ•°å€¼ï¼ˆâ€œspecial numeric valuesâ€ï¼‰â€ä¹Ÿå±äºè¿™ç§ç±»å‹ï¼š`Infinity`,`-Infinity`Â å’ŒÂ `NaN`ã€‚

- `Infinity`Â æ˜¯*å…¨å±€å¯¹è±¡*ï¼ˆ*global object*ï¼‰çš„ä¸€ä¸ªå±æ€§ï¼Œå³å®ƒæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ã€‚`Infinity`Â çš„åˆå§‹å€¼æ˜¯Â [`Number.POSITIVE_INFINITY`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Number/POSITIVE_INFINITY)ã€‚`Infinity`ï¼ˆæ­£æ— ç©·å¤§ï¼‰å¤§äºä»»ä½•å€¼ã€‚
- `NaN`Â ä»£è¡¨ä¸€ä¸ªè®¡ç®—é”™è¯¯ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸æ­£ç¡®çš„æˆ–è€…ä¸€ä¸ªæœªå®šä¹‰çš„æ•°å­¦æ“ä½œæ‰€å¾—åˆ°çš„ç»“æœã€‚`NaN`Â æ˜¯ç²˜æ€§çš„ã€‚ä»»ä½•å¯¹Â `NaN`Â çš„è¿›ä¸€æ­¥æ•°å­¦è¿ç®—éƒ½ä¼šè¿”å›Â `NaN`ï¼ˆåªæœ‰ä¸€ä¸ªä¾‹å¤–ï¼š`NaN ** 0`Â ç»“æœä¸ºÂ `1`ï¼‰ã€‚



##### `BigInt`

ç”¨äºä»»æ„é•¿åº¦çš„æ•´æ•°ã€‚

- åœ¨ JavaScript ä¸­ï¼Œâ€œnumberâ€ ç±»å‹æ— æ³•å®‰å…¨åœ°è¡¨ç¤ºå¤§äºÂ `(2^53 - 1)`ï¼ˆå³Â `9007199254740991`ï¼‰ï¼Œæˆ–å°äºÂ `-(2^53 - 1)`Â çš„æ•´æ•°ã€‚
- æ›´å‡†ç¡®çš„è¯´ï¼Œâ€œnumberâ€ ç±»å‹å¯ä»¥å­˜å‚¨æ›´å¤§çš„æ•´æ•°ï¼ˆæœ€å¤šÂ `1.7976931348623157 * 10^308`ï¼‰ï¼Œä½†è¶…å‡ºå®‰å…¨æ•´æ•°èŒƒå›´Â `Â±(2^53 - 1)`Â ä¼šå‡ºç°ç²¾åº¦é—®é¢˜ï¼Œå› ä¸ºå¹¶éæ‰€æœ‰æ•°å­—éƒ½é€‚åˆå›ºå®šçš„ 64 ä½å­˜å‚¨ã€‚å› æ­¤ï¼Œå¯èƒ½å­˜å‚¨çš„æ˜¯â€œè¿‘ä¼¼å€¼â€ã€‚
  
    ```jsx
    console.log(Math.pow(2, 53) - 1); // 9007199254740991
    console.log(9007199254740991 + 1); // 9007199254740992
    console.log(9007199254740991 + 2); // 9007199254740992
    ```
    
- å¯ä»¥é€šè¿‡å°†Â `n`Â é™„åŠ åˆ°æ•´æ•°å­—æ®µçš„æœ«å°¾æ¥åˆ›å»ºÂ `BigInt`Â å€¼ã€‚e.g.`const bigInt = 1234567890123456789012345678901234567890n;`
- æŸ¥çœ‹Â [MDNÂ BigInt å…¼å®¹æ€§è¡¨](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt#browser_compatibility)Â ä»¥äº†è§£å“ªäº›ç‰ˆæœ¬çš„æµè§ˆå™¨å·²ç»æ”¯æŒ BigInt äº†ã€‚



##### `String`

ä¸€ä¸ªå­—ç¬¦ä¸²å¯ä»¥åŒ…å«é›¶ä¸ªï¼ˆä¸ºç©ºï¼‰ã€ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ï¼Œæ²¡æœ‰å•ç‹¬çš„å•å­—ç¬¦ç±»å‹ã€‚



##### `Boolean`

é€»è¾‘ç±»å‹ï¼Œç”¨äºÂ `true`Â å’ŒÂ `false`ã€‚



##### `null`

ç”¨äºæœªçŸ¥çš„å€¼ â€”â€” åªæœ‰ä¸€ä¸ªÂ `null`Â å€¼çš„ç‹¬ç«‹ç±»å‹ã€‚

ç›¸æ¯”è¾ƒäºå…¶ä»–ç¼–ç¨‹è¯­è¨€ï¼ŒJavaScript ä¸­çš„Â `null`Â ä¸æ˜¯ä¸€ä¸ªâ€œå¯¹ä¸å­˜åœ¨çš„Â `object`Â çš„å¼•ç”¨â€æˆ–è€… â€œnull æŒ‡é’ˆâ€ã€‚

JavaScript ä¸­çš„Â `null`Â ä»…ä»…æ˜¯ä¸€ä¸ªä»£è¡¨â€œæ— â€ã€â€œç©ºâ€æˆ–â€œå€¼æœªçŸ¥â€çš„ç‰¹æ®Šå€¼ã€‚



##### `undefined`

ç”¨äºæœªå®šä¹‰çš„å€¼ â€”â€” åªæœ‰ä¸€ä¸ªÂ `undefined`Â å€¼çš„ç‹¬ç«‹ç±»å‹ã€‚

- `undefined` çš„å«ä¹‰æ˜¯Â `æœªè¢«èµ‹å€¼`ã€‚
- å¦‚æœä¸€ä¸ªå˜é‡å·²è¢«å£°æ˜ï¼Œä½†æœªè¢«èµ‹å€¼ï¼Œé‚£ä¹ˆå®ƒçš„å€¼å°±æ˜¯Â `undefined` ã€‚
- ä»æŠ€æœ¯ä¸Šè®²ï¼Œå¯ä»¥æ˜¾å¼åœ°å°†Â `undefined`Â èµ‹å€¼ç»™å˜é‡ã€‚â€¦â€¦ä½†æ˜¯ä¸å»ºè®®è¿™æ ·åšã€‚é€šå¸¸ï¼Œä½¿ç”¨Â `null`Â å°†ä¸€ä¸ªâ€œç©ºâ€æˆ–è€…â€œæœªçŸ¥â€çš„å€¼å†™å…¥å˜é‡ä¸­ï¼Œè€ŒÂ `undefined`Â åˆ™ä¿ç•™ä½œä¸ºæœªè¿›è¡Œåˆå§‹åŒ–çš„äº‹ç‰©çš„é»˜è®¤åˆå§‹å€¼ã€‚



##### `Symbol`

ç”¨äºå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚



#### everything else is known as an *Object*.

##### `Object`

Common object types include:

- `Function`
- `Array`
- `Date`
- `RegExp`
- `Error`

Object ç”¨äºæ›´å¤æ‚çš„æ•°æ®ç»“æ„ã€‚

å…¶ä»–æ‰€æœ‰çš„æ•°æ®ç±»å‹éƒ½è¢«ç§°ä¸ºâ€œåŸå§‹ç±»å‹â€ï¼Œå› ä¸ºå®ƒä»¬çš„å€¼åªåŒ…å«ä¸€ä¸ªå•ç‹¬çš„å†…å®¹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—æˆ–è€…å…¶ä»–ï¼‰ã€‚ç›¸åï¼Œ`object`Â åˆ™ç”¨äºå‚¨å­˜æ•°æ®é›†åˆå’Œæ›´å¤æ‚çš„å®ä½“ã€‚



#### The typeof operator

å¯ä»¥é€šè¿‡Â `typeof`Â è¿ç®—ç¬¦æŸ¥çœ‹å­˜å‚¨åœ¨å˜é‡ä¸­çš„æ•°æ®ç±»å‹ã€‚å¯¹Â `typeof x`Â æˆ– `typeof(x)` çš„è°ƒç”¨ä¼šä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¿”å›æ•°æ®ç±»å‹ã€‚
- `typeof`Â æ˜¯ä¸€ä¸ªæ“ä½œç¬¦ï¼Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚è¿™é‡Œçš„æ‹¬å·ä¸æ˜¯Â `typeof`Â çš„ä¸€éƒ¨åˆ†ã€‚å®ƒæ˜¯æ•°å­¦è¿ç®—åˆ†ç»„çš„æ‹¬å·ã€‚
- `typeof null`Â çš„ç»“æœä¸ºÂ `"object"`ã€‚è¿™æ˜¯å®˜æ–¹æ‰¿è®¤çš„Â `typeof`Â çš„é”™è¯¯ï¼Œè¿™ä¸ªé—®é¢˜æ¥è‡ªäº JavaScript è¯­è¨€çš„æ—©æœŸé˜¶æ®µï¼Œå¹¶ä¸ºäº†å…¼å®¹æ€§è€Œä¿ç•™äº†ä¸‹æ¥ã€‚
  
    `null`Â ç»å¯¹ä¸æ˜¯ä¸€ä¸ªÂ `object`ã€‚`null`Â æœ‰è‡ªå·±çš„ç±»å‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šå€¼ã€‚`typeof`Â çš„è¡Œä¸ºåœ¨è¿™é‡Œæ˜¯é”™è¯¯çš„ã€‚
    
- åœ¨ JavaScript è¯­è¨€ä¸­æ²¡æœ‰ä¸€ä¸ªç‰¹åˆ«çš„ `â€œfunctionâ€` ç±»å‹ã€‚å‡½æ•°éš¶å±äºÂ `object`Â ç±»å‹ã€‚ä½†æ˜¯Â `typeof`Â ä¼šå¯¹å‡½æ•°åŒºåˆ†å¯¹å¾…ï¼Œå¹¶è¿”å›Â `"function"`ã€‚è¿™ä¹Ÿæ˜¯æ¥è‡ªäº JavaScript è¯­è¨€æ—©æœŸçš„é—®é¢˜ã€‚
  
    ä»æŠ€æœ¯ä¸Šè®²ï¼Œè¿™ç§è¡Œä¸ºæ˜¯ä¸æ­£ç¡®çš„ï¼Œä½†åœ¨å®é™…ç¼–ç¨‹ä¸­å´éå¸¸æ–¹ä¾¿ã€‚
    

```javascript
typeof 0 // 'number'
typeof 10n // 'bigint'
typeof 'foo' // 'string'
typeof true // 'boolean'
typeof null // 'object'
typeof undefined // 'undefined'
typeof Symbol('id') // 'symbol'
typeof Math // 'object' // Math æ˜¯ä¸€ä¸ªæä¾›æ•°å­¦è¿ç®—çš„å†…å»º object
typeof alert // 'function'
```





### 2.6 Interaction: alert, prompt, confirm

- **`alert`** æ˜¾ç¤ºä¿¡æ¯ã€‚
  
    å¼¹å‡ºçš„è¿™ä¸ªå¸¦æœ‰ä¿¡æ¯çš„å°çª—å£è¢«ç§°ä¸ºÂ **æ¨¡æ€çª—** *modal window*
    
    â€œmodalâ€ æ„å‘³ç€ç”¨æˆ·ä¸èƒ½ä¸é¡µé¢çš„å…¶ä»–éƒ¨åˆ†ï¼ˆä¾‹å¦‚ç‚¹å‡»å…¶ä»–æŒ‰é’®ç­‰ï¼‰è¿›è¡Œäº¤äº’ï¼Œç›´åˆ°ä»–ä»¬å¤„ç†å®Œçª—å£ã€‚
    
- **`prompt`** æ˜¾ç¤ºä¿¡æ¯è¦æ±‚ç”¨æˆ·è¾“å…¥æ–‡æœ¬ã€‚ç‚¹å‡»ç¡®å®šè¿”å›æ–‡æœ¬ï¼Œç‚¹å‡»å–æ¶ˆæˆ–æŒ‰ä¸‹Â EscÂ é”®è¿”å›Â `null`ã€‚
  
    æµè§ˆå™¨ä¼šæ˜¾ç¤ºä¸€ä¸ªå¸¦æœ‰æ–‡æœ¬æ¶ˆæ¯çš„æ¨¡æ€çª—å£ï¼Œè¿˜æœ‰ input æ¡†å’Œç¡®å®š/å–æ¶ˆæŒ‰é’®ã€‚
    
    `result = prompt(title, [default]);`
    
    - `title` æ˜¾ç¤ºç»™ç”¨æˆ·çš„æ–‡æœ¬ã€‚
    - `default` å¯é€‰çš„ç¬¬äºŒä¸ªå‚æ•°ï¼ŒæŒ‡å®š input æ¡†çš„åˆå§‹å€¼ã€‚
    
    `prompt`Â å°†è¿”å›ç”¨æˆ·åœ¨Â `input`Â æ¡†å†…è¾“å…¥çš„æ–‡æœ¬ï¼Œå¦‚æœç”¨æˆ·å–æ¶ˆäº†è¾“å…¥ï¼Œåˆ™è¿”å›Â `null`ã€‚
    
- **`confirm`** æ˜¾ç¤ºä¿¡æ¯ç­‰å¾…ç”¨æˆ·ç‚¹å‡»ç¡®å®šæˆ–å–æ¶ˆã€‚ç‚¹å‡»ç¡®å®šè¿”å›Â `true`ï¼Œç‚¹å‡»å–æ¶ˆæˆ–æŒ‰ä¸‹Â EscÂ é”®è¿”å›Â `false`ã€‚
  
    `confirm`Â å‡½æ•°æ˜¾ç¤ºä¸€ä¸ªå¸¦æœ‰Â `question`Â ä»¥åŠç¡®å®šå’Œå–æ¶ˆä¸¤ä¸ªæŒ‰é’®çš„æ¨¡æ€çª—å£ã€‚ç‚¹å‡»ç¡®å®šè¿”å›Â `true`ï¼Œç‚¹å‡»å–æ¶ˆè¿”å›Â `false`ã€‚
    

è¿™äº›æ–¹æ³•éƒ½æ˜¯æ¨¡æ€çš„ï¼šå®ƒä»¬æš‚åœè„šæœ¬çš„æ‰§è¡Œï¼Œå¹¶ä¸”ä¸å…è®¸ç”¨æˆ·ä¸è¯¥é¡µé¢çš„å…¶ä½™éƒ¨åˆ†è¿›è¡Œäº¤äº’ï¼Œç›´åˆ°çª—å£è¢«è§£é™¤ã€‚

ä¸Šè¿°æ‰€æœ‰æ–¹æ³•å…±æœ‰ä¸¤ä¸ªé™åˆ¶ï¼š

1. æ¨¡æ€çª—å£çš„ç¡®åˆ‡ä½ç½®ç”±æµè§ˆå™¨å†³å®šã€‚é€šå¸¸åœ¨é¡µé¢ä¸­å¿ƒã€‚
2. çª—å£çš„ç¡®åˆ‡å¤–è§‚ä¹Ÿå–å†³äºæµè§ˆå™¨ã€‚æˆ‘ä»¬ä¸èƒ½ä¿®æ”¹å®ƒã€‚





### 2.7 Type Conversions

å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿ç®—ç¬¦å’Œå‡½æ•°ä¼šè‡ªåŠ¨å°†èµ‹äºˆå®ƒä»¬çš„å€¼è½¬æ¢ä¸ºæ­£ç¡®çš„ç±»å‹ã€‚

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å°†å€¼æ˜¾å¼åœ°è½¬æ¢ä¸ºæˆ‘ä»¬æœŸæœ›çš„ç±»å‹ã€‚

- **å­—ç¬¦ä¸²è½¬æ¢**Â â€”â€” è½¬æ¢å‘ç”Ÿåœ¨è¾“å‡ºå†…å®¹çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥é€šè¿‡Â `String(value)`Â è¿›è¡Œæ˜¾å¼è½¬æ¢ã€‚åŸå§‹ç±»å‹å€¼çš„ string ç±»å‹è½¬æ¢é€šå¸¸æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚
- **æ•°å­—å‹è½¬æ¢**Â â€”â€” è½¬æ¢å‘ç”Ÿåœ¨è¿›è¡Œç®—æœ¯æ“ä½œæ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡Â `Number(value)`Â è¿›è¡Œæ˜¾å¼è½¬æ¢ã€‚
  
    ```jsx
    Number(undefined) // NaN
    Number(null) // 0
    Number(true) // 1
    Number(false) // 0
    // â€œæŒ‰åŸæ ·è¯»å–â€å­—ç¬¦ä¸²ï¼Œä¸¤ç«¯çš„ç©ºæ ¼ä¼šè¢«å¿½ç•¥ã€‚ç©ºå­—ç¬¦ä¸²å˜æˆ 0ã€‚è½¬æ¢å‡ºé”™åˆ™è¾“å‡º NaNã€‚
    Number('  123  ') // 123
    Number('123z') // NaN
    Number('') // 0
    ```
    
- **å¸ƒå°”å‹è½¬æ¢**Â â€”â€” è½¬æ¢å‘ç”Ÿåœ¨è¿›è¡Œé€»è¾‘æ“ä½œæ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡Â `Boolean(value)`Â è¿›è¡Œæ˜¾å¼è½¬æ¢ã€‚
    - æ•°å­—Â `0`ã€ç©ºå­—ç¬¦ä¸²Â `""`ã€`null`ã€`undefined`Â å’ŒÂ `NaN`Â éƒ½ä¼šè¢«è½¬æ¢æˆÂ `false`ã€‚å®ƒä»¬è¢«ç§°ä¸ºâ€œå‡å€¼ï¼ˆfalsyï¼‰â€ã€‚
    - å…¶ä»–å€¼è¢«è½¬æ¢ä¸ºÂ `true`ï¼Œå®ƒä»¬è¢«ç§°ä¸ºâ€œçœŸå€¼ï¼ˆtruthyï¼‰â€ã€‚
- **å¯¹è±¡-åŸå§‹å€¼è½¬æ¢** â€”â€” [4.8 Object to primitive conversion]





### 2.8 Basic operators, maths

- è¿ç®—å…ƒï¼ˆå‚æ•°ï¼‰ â€”â€” è¿ç®—ç¬¦åº”ç”¨çš„å¯¹è±¡ã€‚
- ä¸€å…ƒè¿ç®—ç¬¦ â€”â€” ä¸€ä¸ªè¿ç®—ç¬¦å¯¹åº”çš„åªæœ‰ä¸€ä¸ªè¿ç®—å…ƒã€‚
  
    å¦‚ä¸€å…ƒè´Ÿå·è¿ç®—ç¬¦ï¼š
    
    ```jsx
    let x = 1;
    
    x = -x;
    console.log( x ); // -1ï¼Œä¸€å…ƒè´Ÿå·è¿ç®—ç¬¦ç”Ÿæ•ˆ
    ```
    
- äºŒå…ƒè¿ç®—ç¬¦ â€”â€” ä¸€ä¸ªè¿ç®—ç¬¦æ‹¥æœ‰ä¸¤ä¸ªè¿ç®—å…ƒã€‚
- æ•°å­¦è¿ç®— â€”â€” åŠ æ³• `+`ï¼Œå‡æ³• `-`ï¼Œä¹˜æ³• `*`ï¼Œé™¤æ³• `/`ï¼Œå–ä½™ `%`ï¼Œæ±‚å¹‚ `**`ã€‚
- ç”¨äºŒå…ƒè¿ç®—ç¬¦ `+` è¿æ¥å­—ç¬¦ä¸²
  
    å¦‚æœåŠ å·Â `+`Â è¢«åº”ç”¨äºå­—ç¬¦ä¸²ï¼Œå®ƒå°†åˆå¹¶ï¼ˆè¿æ¥ï¼‰å„ä¸ªå­—ç¬¦ä¸²ã€‚
    
    :warning:åªè¦ä»»æ„ä¸€ä¸ªè¿ç®—å…ƒæ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªè¿ç®—å…ƒä¹Ÿå°†è¢«è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚
    
    ```jsx
    console.log( '1' + 2 ); // "12"
    console.log( 2 + '1' ); // "21"
    console.log( 2 + 2 + '1' ); // "41"ï¼Œä¸æ˜¯ "221"
    console.log( '1' + 2 + 2); // "122"ï¼Œä¸æ˜¯ "14"
    ```
    
    :warning:äºŒå…ƒÂ `+`Â æ˜¯å”¯ä¸€ä¸€ä¸ªä»¥è¿™ç§æ–¹å¼æ”¯æŒå­—ç¬¦ä¸²çš„è¿ç®—ç¬¦ã€‚å…¶ä»–ç®—æœ¯è¿ç®—ç¬¦åªå¯¹æ•°å­—èµ·ä½œç”¨ï¼Œå¹¶ä¸”æ€»æ˜¯å°†å…¶è¿ç®—å…ƒè½¬æ¢ä¸ºæ•°å­—ã€‚
    
    ```jsx
    console.log( 6 - '2' ); // 4ï¼Œå°† '2' è½¬æ¢ä¸ºæ•°å­—
    console.log( '6' / '2' ); // 3ï¼Œå°†ä¸¤ä¸ªè¿ç®—å…ƒéƒ½è½¬æ¢ä¸ºæ•°å­—
    
    console.log(" \t \n" - 2); // -2
    // å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—æ—¶ï¼Œä¼šå¿½ç•¥å­—ç¬¦ä¸²çš„é¦–å°¾å¤„çš„ç©ºæ ¼å­—ç¬¦ã€‚åœ¨è¿™é‡Œï¼Œæ•´ä¸ªå­—ç¬¦ä¸²ç”±ç©ºæ ¼å­—ç¬¦ç»„æˆï¼ŒåŒ…æ‹¬ \tã€\n ä»¥åŠå®ƒä»¬ä¹‹é—´çš„â€œå¸¸è§„â€ç©ºæ ¼ã€‚å› æ­¤ï¼Œç±»ä¼¼äºç©ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä¼šå˜ä¸º 0ã€‚
    ```
    
- æ•°å­—è½¬æ¢ï¼Œä¸€å…ƒè¿ç®— `+`
  
    ä¸€å…ƒè¿ç®—ç¬¦åŠ å·Â `+`Â åº”ç”¨äºå•ä¸ªå€¼ï¼Œå¯¹æ•°å­—æ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚ä½†æ˜¯å¦‚æœè¿ç®—å…ƒä¸æ˜¯æ•°å­—ï¼ŒåŠ å·Â `+`Â åˆ™ä¼šå°†å…¶è½¬åŒ–ä¸ºæ•°å­—ã€‚å®ƒçš„æ•ˆæœå’ŒÂ `Number(...)`Â ç›¸åŒï¼Œä½†æ˜¯æ›´åŠ ç®€çŸ­ã€‚
    
    ```jsx
    // å¯¹æ•°å­—æ— æ•ˆ
    let x = 1;
    console.log( +x ); // 1
    
    let y = -2;
    console.log( +y ); // -2
    
    // è½¬åŒ–éæ•°å­—
    console.log( +true ); // 1
    console.log( +"" );   // 0
    
    let apples = "2";
    let oranges = "3";
    
    // åœ¨äºŒå…ƒè¿ç®—ç¬¦åŠ å·èµ·ä½œç”¨ä¹‹å‰ï¼Œæ‰€æœ‰çš„å€¼éƒ½è¢«è½¬åŒ–ä¸ºäº†æ•°å­—
    console.log( +apples + +oranges ); // 5
    
    // æ›´é•¿çš„å†™æ³•
    console.log( Number(apples) + Number(oranges) ); // 5
    ```
    
- è¿ç®—ç¬¦ä¼˜å…ˆçº§ â€”â€” [MDN Operator Precedence](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Operator_Precedence)
- è‡ªå¢ / è‡ªå‡
    - å¦‚æœè‡ªå¢/è‡ªå‡çš„å€¼ä¸ä¼šè¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆä¸¤è€…å½¢å¼æ²¡æœ‰åŒºåˆ«ã€‚
    - å¦‚æœæƒ³è¦å¯¹å˜é‡è¿›è¡Œè‡ªå¢æ“ä½œï¼Œå¹¶ä¸”éœ€è¦ç«‹åˆ»ä½¿ç”¨è‡ªå¢åçš„å€¼ï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨å‰ç½®å½¢å¼ï¼ˆ`++counter`ï¼‰ã€‚
    - å¦‚æœæƒ³è¦å°†ä¸€ä¸ªæ•°åŠ ä¸€ï¼Œä½†æ˜¯æƒ³ä½¿ç”¨å…¶è‡ªå¢ä¹‹å‰çš„å€¼ï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨åç½®å½¢å¼ï¼ˆ`counter++`ï¼‰ã€‚
    
    ```jsx
    let counterBack = 3;
    let counterFront = 3;
    
    const resBack = counterBack++;
    console.log('counterBack:', counterBack); // counterBack: 4
    console.log('resBack:', resBack); // resBack: 3
    
    const resFront = ++counterFront;
    console.log('counterFront:', counterFront); // counterFront: 4
    console.log('resFront:', resFront); // resFront: 4
    
    let counter = 3;
    console.log( 2 * counter++); // 6
    console.log(counter); // 4
    
    counter = 3;
    console.log( 2 * ++counter); // 8
    console.log(counter); // 4
    ```
    
- ä½è¿ç®—ç¬¦ â€”â€” [MDN Expressions and Operators](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Expressions_and_Operators)
- é€—å·è¿ç®—ç¬¦ â€”â€” [MDN Comma operator (,)](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Comma_Operator)





### 2.9 Comparisons

- æ¯”è¾ƒè¿ç®—ç¬¦å§‹ç»ˆè¿”å›å¸ƒå°”å€¼ã€‚
- å­—ç¬¦ä¸²çš„æ¯”è¾ƒï¼Œä¼šæŒ‰ç…§â€œè¯å…¸â€é¡ºåºé€å­—ç¬¦åœ°æ¯”è¾ƒå¤§å°ã€‚å³å­—ç¬¦ä¸²æ˜¯æŒ‰å­—ç¬¦é€ä¸ªè¿›è¡Œ **Unicode ç¼–ç é¡ºåº** çš„æ¯”è¾ƒã€‚
  
    å­—ç¬¦ä¸²çš„æ¯”è¾ƒç®—æ³•ï¼š
    
    1. é¦–å…ˆæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„é¦–ä½å­—ç¬¦å¤§å°ã€‚
    2. å¦‚æœä¸€æ–¹å­—ç¬¦è¾ƒå¤§ï¼ˆæˆ–è¾ƒå°ï¼‰ï¼Œåˆ™è¯¥å­—ç¬¦ä¸²å¤§äºï¼ˆæˆ–å°äºï¼‰å¦ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ç®—æ³•ç»“æŸã€‚
    3. å¦åˆ™ï¼Œå¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²çš„é¦–ä½å­—ç¬¦ç›¸ç­‰ï¼Œåˆ™ç»§ç»­å–å‡ºä¸¤ä¸ªå­—ç¬¦ä¸²å„è‡ªçš„åä¸€ä½å­—ç¬¦è¿›è¡Œæ¯”è¾ƒã€‚
    4. é‡å¤ä¸Šè¿°æ­¥éª¤è¿›è¡Œæ¯”è¾ƒï¼Œç›´åˆ°æ¯”è¾ƒå®ŒæˆæŸå­—ç¬¦ä¸²çš„æ‰€æœ‰å­—ç¬¦ä¸ºæ­¢ã€‚
    5. å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²çš„å­—ç¬¦åŒæ—¶ç”¨å®Œï¼Œé‚£ä¹ˆåˆ™åˆ¤å®šå®ƒä»¬ç›¸ç­‰ï¼Œå¦åˆ™æœªç»“æŸï¼ˆè¿˜æœ‰æœªæ¯”è¾ƒçš„å­—ç¬¦ï¼‰çš„å­—ç¬¦ä¸²æ›´å¤§ã€‚
    
- å½“å¯¹ä¸åŒç±»å‹çš„å€¼è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œå®ƒä»¬ä¼šå…ˆè¢«è½¬åŒ–ä¸º **æ•°å­—**ï¼ˆä¸åŒ…æ‹¬ä¸¥æ ¼ç›¸ç­‰æ£€æŸ¥ï¼‰å†è¿›è¡Œæ¯”è¾ƒã€‚
- ä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦Â `===`Â åœ¨è¿›è¡Œæ¯”è¾ƒæ—¶ä¸ä¼šåšä»»ä½•çš„ç±»å‹è½¬æ¢ã€‚
- ä¸â€œä¸ç›¸ç­‰â€ç¬¦å·Â `!=`Â ç±»ä¼¼ï¼Œâ€œä¸¥æ ¼ä¸ç›¸ç­‰â€è¡¨ç¤ºä¸ºÂ `!==`ã€‚
- å¯¹ `null` å’Œ `undefined` è¿›è¡Œæ¯”è¾ƒã€‚
    - åœ¨éä¸¥æ ¼ç›¸ç­‰Â `==`Â ä¸‹ï¼Œ`null`Â å’ŒÂ `undefined`Â ç›¸ç­‰ä¸”å„è‡ªä¸ç­‰äºä»»ä½•å…¶ä»–çš„å€¼ï¼ˆåªåœ¨éä¸¥æ ¼ç›¸ç­‰ä¸‹æˆç«‹ï¼‰ã€‚
    - åœ¨ä½¿ç”¨Â `>`Â æˆ–Â `<`Â è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œéœ€è¦æ³¨æ„å˜é‡å¯èƒ½ä¸ºÂ `null/undefined`Â çš„æƒ…å†µã€‚æ¯”è¾ƒå¥½çš„æ–¹æ³•æ˜¯å•ç‹¬æ£€æŸ¥å˜é‡æ˜¯å¦ç­‰äºÂ `null/undefined`ã€‚
      
        å½“ä½¿ç”¨æ•°å­¦å¼æˆ–å…¶ä»–æ¯”è¾ƒæ–¹æ³•Â `< > <= >=`Â æ—¶ï¼š`null/undefined`Â ä¼šè¢«è½¬åŒ–ä¸ºæ•°å­—ï¼š`null`Â è¢«è½¬åŒ–ä¸ºÂ `0`ï¼Œ`undefined`Â è¢«è½¬åŒ–ä¸ºÂ `NaN`ã€‚
        
    - `null` vs `0`
      
        ç›¸ç­‰æ€§æ£€æŸ¥Â `==`Â å’Œæ™®é€šæ¯”è¾ƒç¬¦Â `> < >= <=`Â çš„ä»£ç é€»è¾‘æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚
        
        - è¿›è¡Œå€¼çš„æ¯”è¾ƒæ—¶ï¼Œ`null`Â ä¼šè¢«è½¬åŒ–ä¸ºæ•°å­—ï¼Œå› æ­¤å®ƒè¢«è½¬åŒ–ä¸ºäº†Â `0`ã€‚// æ‰€ä»¥ (3) ä¸­çš„ `null >= 0` è¿”å›å€¼æ˜¯ trueï¼Œ(1) ä¸­ `null > 0` è¿”å›å€¼æ˜¯ falseã€‚
        - `undefined`Â å’ŒÂ `null`Â åœ¨ç›¸ç­‰æ€§æ£€æŸ¥Â `==`Â ä¸­ä¸ä¼šè¿›è¡Œä»»ä½•çš„ç±»å‹è½¬æ¢ï¼Œå®ƒä»¬æœ‰è‡ªå·±ç‹¬ç«‹çš„æ¯”è¾ƒè§„åˆ™ï¼Œæ‰€ä»¥é™¤äº†å®ƒä»¬ä¹‹é—´äº’ç­‰å¤–ï¼Œä¸ä¼šç­‰äºä»»ä½•å…¶ä»–çš„å€¼ã€‚// æ‰€ä»¥ (2) ä¸­ `null == 0` ä¼šè¿”å› falseã€‚
        
        ```javascript
        null > 0 // (1) false
        null == 0 // (2) false
        null >= 0 // (3) true
        ```
        
    - `undefined`Â ä¸åº”è¯¥è¢«ä¸å…¶ä»–å€¼è¿›è¡Œæ¯”è¾ƒã€‚
        - `(1)`Â å’ŒÂ `(2)`Â éƒ½è¿”å›Â `false`Â æ˜¯å› ä¸ºÂ `undefined`Â åœ¨æ¯”è¾ƒä¸­è¢«è½¬æ¢ä¸ºäº†Â `NaN`ï¼Œè€ŒÂ `NaN`Â æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ•°å€¼å‹å€¼ï¼Œå®ƒä¸ä»»ä½•å€¼è¿›è¡Œæ¯”è¾ƒéƒ½ä¼šè¿”å›Â `false`ã€‚
        - `(3)`Â è¿”å›Â `false`Â æ˜¯å› ä¸ºè¿™æ˜¯ä¸€ä¸ªç›¸ç­‰æ€§æ£€æŸ¥ï¼Œè€ŒÂ `undefined`Â åªä¸Â `null`Â ç›¸ç­‰ï¼ˆéä¸¥æ ¼ç›¸ç­‰ä¸‹ï¼‰ï¼Œä¸ä¼šä¸å…¶ä»–å€¼ç›¸ç­‰ã€‚
        
        ```javascript
        undefined < 0 // (1) false
        undefined > 0 // (2) false
        undefined == 0 // (3) false
        ```
        
    - **é¿å…é—®é¢˜**
      
        - é™¤äº†ä¸¥æ ¼ç›¸ç­‰Â `===`Â å¤–ï¼Œå…¶ä»–ä½†å‡¡æ˜¯æœ‰Â `undefined/null`Â å‚ä¸çš„æ¯”è¾ƒï¼Œæˆ‘ä»¬éƒ½éœ€è¦æ ¼å¤–å°å¿ƒã€‚
        - é™¤éä½ éå¸¸æ¸…æ¥šè‡ªå·±åœ¨åšä»€ä¹ˆï¼Œå¦åˆ™æ°¸è¿œä¸è¦ä½¿ç”¨Â `>= > < <=`Â å»æ¯”è¾ƒä¸€ä¸ªå¯èƒ½ä¸ºÂ `null/undefined`Â çš„å˜é‡ã€‚å¯¹äºå–å€¼å¯èƒ½æ˜¯Â `null/undefined`Â çš„å˜é‡ï¼Œè¯·æŒ‰éœ€è¦åˆ†åˆ«æ£€æŸ¥å®ƒçš„å–å€¼æƒ…å†µã€‚





### 2.10 Conditional branching: if, '?'

*omitted*





### 2.11 Logical operators

JavaScript ä¸­æœ‰å››ä¸ªé€»è¾‘è¿ç®—ç¬¦ï¼š`||`ï¼ˆæˆ–ï¼‰ï¼Œ`&&`ï¼ˆä¸ï¼‰ï¼Œ`!`ï¼ˆéï¼‰ï¼Œ`??`ï¼ˆç©ºå€¼åˆå¹¶è¿ç®—ç¬¦ï¼‰ã€‚

è™½ç„¶å®ƒä»¬è¢«ç§°ä¸ºâ€œé€»è¾‘â€è¿ç®—ç¬¦ï¼Œä½†è¿™äº›è¿ç®—ç¬¦å´å¯ä»¥è¢«åº”ç”¨äºä»»æ„ç±»å‹çš„å€¼ï¼Œè€Œä¸ä»…ä»…æ˜¯å¸ƒå°”å€¼ã€‚å®ƒä»¬çš„ç»“æœä¹ŸåŒæ ·å¯ä»¥æ˜¯ä»»æ„ç±»å‹ã€‚å¦‚æœæ“ä½œæ•°ä¸æ˜¯å¸ƒå°”å€¼ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šè¢«è½¬åŒ–ä¸ºå¸ƒå°”å€¼æ¥å‚ä¸è¿ç®—ã€‚

#### `||`ï¼ˆæˆ–ï¼‰
  
æˆ–è¿ç®—ç¬¦Â `||`Â åšäº†å¦‚ä¸‹çš„äº‹æƒ…ï¼ˆæˆ–è¿ç®—å¯»æ‰¾ç¬¬ä¸€ä¸ªçœŸå€¼ï¼‰ï¼š

1. ä»å·¦åˆ°å³ä¾æ¬¡è®¡ç®—æ“ä½œæ•°ã€‚
2. å¤„ç†æ¯ä¸€ä¸ªæ“ä½œæ•°æ—¶ï¼Œéƒ½å°†å…¶è½¬åŒ–ä¸ºå¸ƒå°”å€¼ã€‚å¦‚æœç»“æœæ˜¯Â `true`ï¼Œå°±åœæ­¢è®¡ç®—ï¼Œè¿”å›è¿™ä¸ªæ“ä½œæ•°çš„åˆå§‹å€¼ã€‚
3. å¦‚æœæ‰€æœ‰çš„æ“ä½œæ•°éƒ½è¢«è®¡ç®—è¿‡ï¼ˆä¹Ÿå°±æ˜¯ï¼Œè½¬æ¢ç»“æœéƒ½æ˜¯Â `false`ï¼‰ï¼Œåˆ™è¿”å›æœ€åä¸€ä¸ªæ“ä½œæ•°ã€‚

```jsx
console.log( 1 || 0 ); // 1ï¼ˆ1 æ˜¯çœŸå€¼ï¼‰
console.log( null || 1 ); // 1ï¼ˆ1 æ˜¯ç¬¬ä¸€ä¸ªçœŸå€¼ï¼‰
console.log( null || 0 || 2 || 1 ); // 2ï¼ˆç¬¬ä¸€ä¸ªçœŸå€¼ï¼‰
console.log( undefined || null || 0 ); // 0ï¼ˆéƒ½æ˜¯å‡å€¼ï¼Œè¿”å›æœ€åä¸€ä¸ªå€¼ï¼‰
```

ä¸€äº›æœ‰è¶£çš„ç”¨æ³•ï¼š

- è·å–å˜é‡åˆ—è¡¨æˆ–è€…è¡¨è¾¾å¼ä¸­çš„ç¬¬ä¸€ä¸ªçœŸå€¼ã€‚
- çŸ­è·¯æ±‚å€¼ï¼ˆShort-circuit evaluationï¼‰ã€‚
  
	`||`Â å¯¹å…¶å‚æ•°è¿›è¡Œå¤„ç†ï¼Œç›´åˆ°è¾¾åˆ°ç¬¬ä¸€ä¸ªçœŸå€¼ï¼Œç„¶åç«‹å³è¿”å›è¯¥å€¼ï¼Œè€Œæ— éœ€å¤„ç†å…¶ä»–å‚æ•°ã€‚
	
	å¦‚æœæ“ä½œæ•°ä¸ä»…ä»…æ˜¯ä¸€ä¸ªå€¼ï¼Œè€Œæ˜¯ä¸€ä¸ªæœ‰å‰¯ä½œç”¨çš„è¡¨è¾¾å¼ï¼Œä¾‹å¦‚å˜é‡èµ‹å€¼æˆ–å‡½æ•°è°ƒç”¨ï¼Œé‚£ä¹ˆè¿™ä¸€ç‰¹æ€§çš„é‡è¦æ€§å°±å˜å¾—æ˜¾è€Œæ˜“è§äº†ã€‚
	
	æœ‰æ—¶ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œåªåœ¨å·¦ä¾§çš„æ¡ä»¶ä¸ºå‡æ—¶æ‰æ‰§è¡Œå‘½ä»¤ã€‚
	
	```jsx
	true || alert("not printed");
	false || alert("printed");
	```
	

***test:***

`alert( alert(1) || 2 || alert(3) );` ä½¿ç”¨ `console.log()` æ•ˆæœä¸€æ ·ã€‚

å¯¹Â `alert`Â çš„è°ƒç”¨æ²¡æœ‰è¿”å›å€¼ã€‚æˆ–è€…è¯´è¿”å›çš„æ˜¯Â `undefined`ã€‚

1. ç¬¬ä¸€ä¸ªæˆ–è¿ç®—Â `||`Â å¯¹å®ƒçš„å·¦å€¼Â `alert(1)`Â è¿›è¡Œäº†è®¡ç®—ã€‚è¿™å°±æ˜¾ç¤ºäº†ç¬¬ä¸€æ¡ä¿¡æ¯Â `1`ã€‚
2. å‡½æ•°Â `alert`Â è¿”å›äº†Â `undefined`ï¼Œæ‰€ä»¥æˆ–è¿ç®—ç»§ç»­æ£€æŸ¥ç¬¬äºŒä¸ªæ“ä½œæ•°ä»¥å¯»æ‰¾çœŸå€¼ã€‚
3. ç¬¬äºŒä¸ªæ“ä½œæ•°Â `2`Â æ˜¯çœŸå€¼ï¼Œæ‰€ä»¥æ‰§è¡Œå°±ä¸­æ–­äº†ã€‚`2`Â è¢«è¿”å›ï¼Œå¹¶ä¸”è¢«å¤–å±‚çš„ `alert` æ˜¾ç¤ºã€‚

è¿™é‡Œä¸ä¼šæ˜¾ç¤ºÂ `3`ï¼Œå› ä¸ºè¿ç®—æ²¡æœ‰æŠµè¾¾Â `alert(3)`ã€‚

#### `&&`ï¼ˆä¸ï¼‰

ä¸è¿ç®—Â `&&`Â åšäº†å¦‚ä¸‹çš„äº‹ï¼ˆä¸è¿ç®—å¯»æ‰¾ç¬¬ä¸€ä¸ªå‡æ¤ï¼‰ï¼š

1. ä»å·¦åˆ°å³ä¾æ¬¡è®¡ç®—æ“ä½œæ•°ã€‚
2. åœ¨å¤„ç†æ¯ä¸€ä¸ªæ“ä½œæ•°æ—¶ï¼Œéƒ½å°†å…¶è½¬åŒ–ä¸ºå¸ƒå°”å€¼ã€‚å¦‚æœç»“æœæ˜¯Â `false`ï¼Œå°±åœæ­¢è®¡ç®—ï¼Œå¹¶è¿”å›è¿™ä¸ªæ“ä½œæ•°çš„åˆå§‹å€¼ã€‚
3. å¦‚æœæ‰€æœ‰çš„æ“ä½œæ•°éƒ½è¢«è®¡ç®—è¿‡ï¼ˆä¾‹å¦‚éƒ½æ˜¯çœŸå€¼ï¼‰ï¼Œåˆ™è¿”å›æœ€åä¸€ä¸ªæ“ä½œæ•°ã€‚

```jsx
// å¦‚æœç¬¬ä¸€ä¸ªæ“ä½œæ•°æ˜¯çœŸå€¼ï¼Œ
// ä¸è¿ç®—è¿”å›ç¬¬äºŒä¸ªæ“ä½œæ•°ï¼š
console.log( 1 && 0 ); // 0
console.log( 1 && 5 ); // 5

// å¦‚æœç¬¬ä¸€ä¸ªæ“ä½œæ•°æ˜¯å‡å€¼ï¼Œ
// ä¸è¿ç®—å°†ç›´æ¥è¿”å›å®ƒã€‚ç¬¬äºŒä¸ªæ“ä½œæ•°ä¼šè¢«å¿½ç•¥
console.log( null && 5 ); // null
console.log( 0 && "no matter what" ); // 0

console.log( 1 && 2 && null && 3 ); // null
console.log( 1 && 2 && 3 ); // 3ï¼Œæœ€åä¸€ä¸ªå€¼
```

- :warning:**ä¸è¦ç”¨Â `||`Â æˆ–Â `&&`Â æ¥å–ä»£Â `if`**
  
	æœ‰æ—¶å€™ï¼Œæœ‰äººä¼šå°†ä¸è¿ç®—ç¬¦Â `&&`Â ä½œä¸ºâ€œç®€åŒ–Â `if`â€çš„ä¸€ç§æ–¹å¼ã€‚
	
	è™½ç„¶ä½¿ç”¨Â `&&`Â å†™å‡ºçš„å˜ä½“çœ‹èµ·æ¥æ›´çŸ­ï¼Œä½†Â `if`Â æ›´æ˜æ˜¾ï¼Œå¹¶ä¸”å¾€å¾€æ›´å…·å¯è¯»æ€§ã€‚
	å› æ­¤ï¼Œæˆ‘ä»¬å»ºè®®æ ¹æ®æ¯ä¸ªè¯­æ³•ç»“æ„çš„ç”¨é€”æ¥ä½¿ç”¨ï¼šå¦‚æœæˆ‘ä»¬æƒ³è¦Â `if`ï¼Œå°±ä½¿ç”¨Â `if`ï¼›å¦‚æœæˆ‘ä»¬æƒ³è¦é€»è¾‘ä¸ï¼Œå°±ä½¿ç”¨Â `&&`ã€‚
	
	```jsx
	let x = 1;
	(x > 0) && console.log( 'Greater than zero!' );
	if (x > 0) console.log( 'Greater than zero!' );
	```
	

***test:***

`alert( alert(1) && alert(2) );` ä½¿ç”¨ `console.log()` æ•ˆæœä¸€æ ·ã€‚

è°ƒç”¨Â `alert`Â è¿”å›äº†Â `undefined`ï¼ˆå®ƒåªå±•ç¤ºæ¶ˆæ¯ï¼Œæ‰€ä»¥æ²¡æœ‰æœ‰æ„ä¹‰çš„è¿”å›å€¼ï¼‰ã€‚

å› æ­¤ï¼Œ`&&`Â è®¡ç®—äº†å®ƒå·¦è¾¹çš„æ“ä½œæ•°ï¼ˆæ˜¾ç¤ºÂ `1`ï¼‰ï¼Œç„¶åç«‹å³åœæ­¢äº†ï¼Œå› ä¸ºÂ `undefined`Â æ˜¯ä¸€ä¸ªå‡å€¼ã€‚`&&`Â å°±æ˜¯å¯»æ‰¾å‡å€¼ç„¶åè¿”å›å®ƒï¼Œæ‰€ä»¥è¿ç®—ç»“æŸã€‚

#### `!`ï¼ˆéï¼‰

é€»è¾‘éè¿ç®—ç¬¦æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå¹¶æŒ‰å¦‚ä¸‹è¿ä½œï¼š

1. å°†æ“ä½œæ•°è½¬åŒ–ä¸ºå¸ƒå°”ç±»å‹ï¼š`true/false`ã€‚
2. è¿”å›ç›¸åçš„å€¼ã€‚

ä¸¤ä¸ªéè¿ç®—Â `!!`Â æœ‰æ—¶å€™ç”¨æ¥å°†æŸä¸ªå€¼è½¬åŒ–ä¸ºå¸ƒå°”ç±»å‹ï¼š

```jsx
console.log( !!"non-empty string" ); // true // Boolean("non-empty string") å®ç°åŒæ ·çš„æ•ˆæœ
console.log( !!null ); // false // Boolean(null) å®ç°åŒæ ·çš„æ•ˆæœ
```




### 2.12 Nullish coalescing operator '??' - ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦

:warning:**è¿™æ˜¯ä¸€ä¸ªæœ€è¿‘æ·»åŠ åˆ° JavaScript çš„ç‰¹æ€§ã€‚ æ—§å¼æµè§ˆå™¨å¯èƒ½éœ€è¦ polyfills.**





### 2.13 Loops: while and for

### 2.14 The "switch" statement

### 2.15 Functions

### 2.16 Functions expressions

### 2.17 Arrow functions, the basics

### 2.18 JavaScript specials

## 3 - Code quality

## 4 - Objects: the basics

### 4.1 Objects

### 4.2 Object references and copying

### 4.3 Garbage collection

### 4.4 Object methods, â€œthisâ€

### 4.5 Constructor, operator â€œnewâ€

### 4.6 Optional chaining â€˜?.â€™

### 4.7 Symbol type

### 4.8 Object to primitive conversion

## 5 - Data types

## 6 - Advanced working with functions

https://zh.javascript.info/advanced-functions

### 6.5 Global object

- [MDN Global object](https://developer.mozilla.org/en-US/docs/Glossary/Global_object) 
- [MDN globalThis](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/globalThis) 
- [MDN Window](https://developer.mozilla.org/zh-CN/docs/Web/API/Window) 


å…¨å±€å¯¹è±¡æä¾›å¯åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨çš„å˜é‡å’Œå‡½æ•°ã€‚

**ç‰¹ç‚¹**
- å…¨å±€å¯¹è±¡çš„æ‰€æœ‰å±æ€§éƒ½å¯ä»¥è¢«ç›´æ¥è®¿é—®ã€‚
- å…¨å±€å¯¹è±¡æœ‰ä¸€ä¸ªé€šç”¨åç§°Â `globalThis`ã€‚
	> â€¦â€¦ä½†æ˜¯æ›´å¸¸è§çš„æ˜¯ä½¿ç”¨â€œè€å¼â€çš„ç¯å¢ƒç‰¹å®šï¼ˆenvironment-specificï¼‰çš„åå­—ï¼Œä¾‹å¦‚Â `window`ï¼ˆæµè§ˆå™¨ï¼‰å’ŒÂ `global`ï¼ˆNode.jsï¼‰ã€‚
- åœ¨æµè§ˆå™¨ä¸­ï¼Œ
	- ä½¿ç”¨Â `var`ï¼ˆè€Œä¸æ˜¯Â `let/const`ï¼ï¼‰å£°æ˜çš„å…¨å±€å‡½æ•°å’Œå˜é‡ä¼šæˆä¸ºå…¨å±€å¯¹è±¡çš„å±æ€§ã€‚
	- å‡½æ•°å£°æ˜ï¼ˆç‰¹æŒ‡åœ¨ä¸»ä»£ç æµä¸­å…·æœ‰Â `function`Â å…³é”®å­—çš„è¯­å¥ï¼Œè€Œä¸æ˜¯å‡½æ•°è¡¨è¾¾å¼ï¼‰ä¹Ÿæœ‰è¿™æ ·çš„æ•ˆæœï¼Œå³æˆä¸ºå…¨å±€å¯¹è±¡çš„å±æ€§ã€‚


**ä½¿ç”¨**
- ä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨å…¨å±€å˜é‡ã€‚å…¨å±€å˜é‡åº”å°½å¯èƒ½çš„å°‘ã€‚
- åº”å½“ä½¿ç”¨ç›´æ¥çš„æ–¹å¼è®¿é—®å…¨å±€å¯¹è±¡çš„å±æ€§ï¼Œå¦‚ `window.x`ã€‚


## 7 - Object properties configuration

https://zh.javascript.info/object-basics

### 7.6 å¯é€‰é“¾ "?." Optional chaining

- [MDN å¯é€‰é“¾è¿ç®—ç¬¦ï¼ˆ?.ï¼‰](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Optional_chaining) 

ğŸš©å¸¸è§æŠ¥é”™ï¼š
```js
let user = {}; // ä¸€ä¸ªæ²¡æœ‰ "address" å±æ€§çš„ user å¯¹è±¡

console.log(user.address.street); // Uncaught TypeError: Cannot read properties of undefined (reading 'street')
```
â¡åœ¨å¾ˆå¤šå®é™…åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›å¾—åˆ°çš„æ˜¯Â `undefined`ï¼ˆè¡¨ç¤ºæ²¡æœ‰Â `street`Â å±æ€§ï¼‰è€Œä¸æ˜¯ä¸€ä¸ªé”™è¯¯ã€‚
æ‰€ä»¥ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šè¿™ä¹ˆå†™æ¥è§£å†³â¤µ
```js
let user = {};

console.log(user.address ? user.address.street : undefined);
```
ğŸ˜¥ä½†æ˜¯è¿™ä¹ˆå†™ä¸ä¼˜é›…
ğŸ•ºç‰¹åˆ«å¯¹äºåµŒå¥—å±‚æ¬¡æ›´æ·±çš„å±æ€§ï¼Œä»£ç ä¼šå˜å¾—æ›´ä¸‘ï¼Œå› ä¸ºéœ€è¦æ›´å¤šçš„é‡å¤ã€‚å¦‚â¤µ
```js
let user = {}; // user æ²¡æœ‰ address å±æ€§

console.log(user.address ? user.address.street ? user.address.street.name : null : null);
```
ğŸ˜ å¤ªæ‰¯æ·¡äº†ğŸ˜•å¾ˆéš¾è®©äººç†è§£
æ‰€ä»¥æœ‰æ—¶æˆ‘ä»¬ç”¨ `&&` è¿™ä¹ˆå†™â¤µ
```js
let user = {}; // user æ²¡æœ‰ address å±æ€§

console.log( user.address && user.address.street && user.address.street.name ); // undefinedï¼ˆä¸æŠ¥é”™ï¼‰
```
ğŸ˜ä½†è¿˜æ˜¯ä¸å¤Ÿä¼˜é›…

ğŸ ğŸ¹`?.`
**å¦‚æœå¯é€‰é“¾Â `?.`Â å‰é¢çš„å€¼ä¸ºÂ `undefined`Â æˆ–è€…Â `null`ï¼Œå®ƒä¼šåœæ­¢è¿ç®—å¹¶è¿”å›Â `undefined`ã€‚**
```js
let user = {}; // user æ²¡æœ‰ address å±æ€§

console.log(user?.address?.street); // undefinedï¼ˆä¸æŠ¥é”™ï¼‰
console.log(user.address?.street);Â //Â undefinedï¼ˆä¸æŠ¥é”™ï¼‰
console.log(user.address.street); // Uncaught TypeError: Cannot read properties of undefined (reading 'street')
```
å³ä½¿ å¯¹è±¡Â `user`Â ä¸å­˜åœ¨ï¼Œä½¿ç”¨Â `user?.address`Â æ¥è¯»å–åœ°å€ä¹Ÿæ²¡é—®é¢˜ï¼š
```js
let user = null;

console.log( user?.address ); // undefined
console.log( user?.address.street ); // undefined
```
ğŸ”º**è¯·æ³¨æ„ï¼š`?.`Â è¯­æ³•ä½¿å…¶å‰é¢çš„å€¼æˆä¸ºå¯é€‰å€¼ï¼Œä½†ä¸ä¼šå¯¹å…¶åé¢çš„èµ·ä½œç”¨ã€‚** â¤µ
```js
let user = {};

console.log( user?.address ); // undefined
console.log( user?.address.street ); // Uncaught TypeError: Cannot read properties of undefined (reading 'street')
```
æ›´æ·±å±‚æ¬¡çš„å±æ€§æ˜¯é€šè¿‡å¸¸è§„æ–¹å¼è®¿é—®çš„ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›å®ƒä»¬ä¸­çš„ä¸€äº›ä¹Ÿæ˜¯å¯é€‰çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ›´å¤šçš„Â `?.`Â æ¥æ›¿æ¢Â `.`ã€‚

#### çŸ­è·¯æ•ˆåº”


#### å…¶ä»–å˜ä½“ `?.()` `?.[]`



#### ä½¿ç”¨ / æ€»ç»“
- ä¸è¿‡åº¦ä½¿ç”¨å¯é€‰é“¾ï¼Œåº”åªä½¿ç”¨åœ¨ä¸€äº›ä¸œè¥¿å¯ä»¥ä¸å­˜åœ¨çš„åœ°æ–¹ã€‚ä»¥é¿å…ç¼–ç¨‹é”™è¯¯è¢«æ¶ˆé™¤ï¼Œä½¿è°ƒè¯•æ›´åŠ å›°éš¾ã€‚
- `?.` å‰çš„å˜é‡å¿…é¡»å·²å£°æ˜ï¼ˆä¾‹å¦‚Â `let/const/var user`Â æˆ–ä½œä¸ºä¸€ä¸ªå‡½æ•°å‚æ•°ï¼‰ã€‚å¯é€‰é“¾ä»…é€‚ç”¨äºå·²å£°æ˜çš„å˜é‡ã€‚
	```js
	// å¦‚æœæœªå£°æ˜å˜é‡Â `user`ï¼Œé‚£ä¹ˆÂ `user?.anything`Â ä¼šè§¦å‘ä¸€ä¸ªé”™è¯¯ï¼š
	// let user = {};
	console.log( user?.address ); // Uncaught ReferenceError: user is not defined
	```



## 8 - Prototypes, inheritance

### 8.1 Prototypal inheritance

### 8.2 F.prototype

### 8.3 Native prototypes

### 8.4 Prototype methods, objects without `__proto__`



## 9 - Classes

## 10 - Error handling



### 10.1 Error handling, "try...catch"



#### The "try...catch" syntax



#### Error object



#### Optional "catch" binding



#### Using "try...catch"



#### Throwing our own errors



#### Rethrowing



#### try...catch...finally



#### Global catch



#### Summary



### 10.2 Custom errors, extending Error







## 11 - Promises, async/await



### 11.1 Introduction: callbacks

JavaScript ä¸»æœºï¼ˆhostï¼‰ç¯å¢ƒæä¾›äº†è®¸å¤šå‡½æ•°ï¼Œè¿™äº›å‡½æ•°å…è®¸æˆ‘ä»¬è®¡åˆ’ **å¼‚æ­¥** è¡Œä¸ºï¼ˆasynchronous actionï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬ç°åœ¨å¼€å§‹æ‰§è¡Œçš„è¡Œä¸ºï¼Œä½†å®ƒä»¬ä¼šåœ¨ç¨åå®Œæˆã€‚

![img-asynchronous-sample.png](asynchronous-sample.png)

#### Callback-based asynchronous programming

å®é™…ä¸­çš„å¼‚æ­¥è¡Œä¸ºç¤ºä¾‹ï¼Œå¦‚åŠ è½½è„šæœ¬ï¼ˆå¦‚ä¸‹ï¼‰å’Œæ¨¡å—ã€‚

```javascript
function loadScript(src) {
  // åˆ›å»ºä¸€ä¸ª <script> æ ‡ç­¾ï¼Œå¹¶å°†å…¶é™„åŠ åˆ°é¡µé¢
  // è¿™å°†ä½¿å¾—å…·æœ‰ç»™å®š src çš„è„šæœ¬å¼€å§‹åŠ è½½ï¼Œå¹¶åœ¨åŠ è½½å®Œæˆåè¿è¡Œ
  let script = document.createElement('script');
  script.src = src;
  document.head.append(script);
}
loadScript('./script.js'); // 'script.js' ä¸­æœ‰'function newFuntion() {...}'
// è„šæœ¬æ˜¯'å¼‚æ­¥'è°ƒç”¨çš„ï¼Œå› ä¸ºå®ƒä»ç°åœ¨å¼€å§‹åŠ è½½ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªåŠ è½½å‡½æ•°æ‰§è¡Œå®Œæˆåæ‰è¿è¡Œã€‚
// loadScript ä¸‹é¢çš„ä»£ç ä¸ä¼šç­‰åˆ°è„šæœ¬åŠ è½½å®Œæˆæ‰æ‰§è¡Œã€‚
newFuntion(); // æ­¤æ“ä½œä¸ä¼šæœ‰æ•ˆã€‚è¯¥å‡½æ•°åœ¨'script.js'ä¸­å£°æ˜ï¼Œä½†è„šæœ¬å°šæœªåŠ è½½å®Œæˆã€‚
```

è‡ªç„¶æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨å¯èƒ½æ²¡æœ‰æ—¶é—´åŠ è½½è„šæœ¬ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œ`loadScript` å‡½æ•°å¹¶æ²¡æœ‰æä¾›è·Ÿè¸ªåŠ è½½å®Œæˆçš„æ–¹æ³•ã€‚è„šæœ¬åŠ è½½å¹¶æœ€ç»ˆè¿è¡Œï¼Œä»…æ­¤è€Œå·²ã€‚ä½†æˆ‘ä»¬å¸Œæœ›äº†è§£è„šæœ¬ä½•æ—¶åŠ è½½å®Œæˆï¼Œä»¥ä½¿ç”¨å…¶ä¸­çš„æ–°å‡½æ•°å’Œå˜é‡ã€‚

```javascript
// å¯ä»¥æ·»åŠ  callback å‡½æ•°ä½œä¸º loadScript çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¯¥å‡½æ•°åº”åœ¨è„šæœ¬åŠ è½½å®Œæˆæ—¶æ‰§è¡Œã€‚
// ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ˆé€šå¸¸æ˜¯åŒ¿åå‡½æ•°ï¼‰ï¼Œè¯¥å‡½æ•°ä¼šåœ¨è¡Œä¸ºï¼ˆactionï¼‰å®Œæˆæ—¶è¿è¡Œã€‚
function loadScript(src, callback) {
  let script = document.createElement('script');
  script.src = src;
  script.onload = () => callback(script);
  document.head.append(script);
}
loadScript('./script.js', script => {
  alert(`è„šæœ¬ ${script.src} åŠ è½½å®Œæˆ`);
  alert( newFuntion ); // newFuntion æ˜¯æ‰€åŠ è½½çš„è„šæœ¬ä¸­å£°æ˜çš„ä¸€ä¸ªå‡½æ•°
});
```

> `onload` äº‹ä»¶ï¼šå®ƒé€šå¸¸ä¼šåœ¨è„šæœ¬åŠ è½½å’Œæ‰§è¡Œå®Œæˆåæ‰§è¡Œä¸€ä¸ªå‡½æ•°ã€‚å‚è€ƒ *PART 2 - 5.3 Resource loading: onload and onerror*ã€‚

ä»¥ä¸Šæ˜¯è¢«ç§°ä¸ºâ€œåŸºäºå›è°ƒâ€çš„å¼‚æ­¥ç¼–ç¨‹é£æ ¼ã€‚å¼‚æ­¥æ‰§è¡ŒæŸé¡¹åŠŸèƒ½çš„å‡½æ•°åº”è¯¥æä¾›ä¸€ä¸ª `callback` å‚æ•°ç”¨äºåœ¨ç›¸åº”äº‹ä»¶ï¼ˆå¦‚ä¸Šè¿°çš„è„šæœ¬åŠ è½½äº‹ä»¶ï¼‰å®Œæˆæ—¶è°ƒç”¨ã€‚

ä»£ç ç¤ºä¾‹ï¼š[[CODEPEN] å¼‚æ­¥å¸¸è§æ¡ˆä¾‹ä¹‹å›¾ç‰‡åŠ è½½](https://codepen.io/Vessel420/pen/MWGZRVO)

> éœ€è¦å¼€å¯æ§åˆ¶å°ç¦ç”¨ç½‘ç»œç¼“å­˜ã€‚

![image-asynchronous_load](image-asynchronous_load.png)



#### Callback in callback

ä¾æ¬¡åŠ è½½ä¸¤ä¸ªè„šæœ¬ï¼šç¬¬ä¸€ä¸ªåŠ è½½å®Œæˆåï¼Œç„¶åå†åŠ è½½ç¬¬äºŒä¸ªã€‚

åœ¨å¤–éƒ¨ `loadScript` æ‰§è¡Œå®Œæˆæ—¶ï¼Œå›è°ƒå°±ä¼šå‘èµ·å†…éƒ¨çš„ `loadScript`ã€‚

æ¯ä¸€ä¸ªæ–°è¡Œä¸ºï¼ˆactionï¼‰éƒ½åœ¨å›è°ƒå†…éƒ¨ã€‚å‡ ä¸ªè¿˜å¥½ï¼Œå¤šäº†å°±ä¸å¥½äº†ã€‚

```javascript
loadScript('/my/script.js', function(script) {
    loadScript('/my/script2.js', function(script) {
        loadScript('/my/script3.js', function(script) {
            // ...åŠ è½½å®Œæ‰€æœ‰è„šæœ¬åç»§ç»­
        });
    });
});
```



#### Handling errors

é¿å…è„šæœ¬åŠ è½½å¤±è´¥ï¼Œè·Ÿè¸ªåŠ è½½é”™è¯¯ã€‚

åŠ è½½æˆåŠŸæ—¶ï¼Œå®ƒä¼šè°ƒç”¨ `callback(null, script)`ï¼Œå¦åˆ™è°ƒç”¨ `callback(error)`ã€‚

```javascript
function loadScript(src, callback) {
  let script = document.createElement('script');
  script.src = src;

  script.onload = () => callback(null, script);
  script.onerror = () => callback(new Error(`Script load error for ${src}`));

  document.head.append(script);
}

loadScript('/my/script.js', function(error, script) {
  if (error) {
    // å¤„ç† error
  } else {
    // è„šæœ¬åŠ è½½æˆåŠŸ
  }
});
```

>åœ¨ `loadScript` ä¸­æ‰€ä½¿ç”¨çš„æ–¹æ¡ˆå…¶å®å¾ˆæ™®éã€‚å®ƒè¢«ç§°ä¸ºâ€œError ä¼˜å…ˆå›è°ƒï¼ˆerror-first callbackï¼‰â€é£æ ¼ã€‚
>
>çº¦å®šæ˜¯ï¼š
>
>1. `callback` çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸º `error` è€Œä¿ç•™çš„ã€‚ä¸€æ—¦å‡ºç° errorï¼Œ`callback(err)` å°±ä¼šè¢«è°ƒç”¨ã€‚
>
>2. ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå’Œä¸‹ä¸€ä¸ªå‚æ•°ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼‰ç”¨äºæˆåŠŸçš„ç»“æœã€‚æ­¤æ—¶ `callback(null, result1, result2â€¦)` å°±ä¼šè¢«è°ƒç”¨ã€‚
>
>å› æ­¤ï¼Œå•ä¸€çš„ `callback` å‡½æ•°å¯ä»¥åŒæ—¶å…·æœ‰æŠ¥å‘Š error å’Œä¼ é€’è¿”å›ç»“æœçš„ä½œç”¨ã€‚



#### Pyramid of Doom å„è¿é‡‘å­—å¡”

éšç€è°ƒç”¨åµŒå¥—çš„å¢åŠ ï¼Œä»£ç å±‚æ¬¡å˜å¾—æ›´æ·±ï¼Œç»´æŠ¤éš¾åº¦ä¹Ÿéšä¹‹å¢åŠ ï¼Œå°¤å…¶æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å¯èƒ½åŒ…å«äº†å¾ˆå¤šå¾ªç¯å’Œæ¡ä»¶è¯­å¥çš„çœŸå®ä»£ç ï¼Œè€Œä¸æ˜¯ä¾‹å­ä¸­çš„ `...`ã€‚

åµŒå¥—è°ƒç”¨çš„â€œé‡‘å­—å¡”â€éšç€æ¯ä¸ªå¼‚æ­¥è¡Œä¸ºä¼šå‘å³å¢é•¿ã€‚å¾ˆå¿«å®ƒå°±å¤±æ§äº†ã€‚æ‰€ä»¥è¿™ç§ç¼–ç æ–¹å¼ä¸æ˜¯å¾ˆå¥½ã€‚

```javascript
loadScript('1.js', function(error, script) {

  if (error) {
    handleError(error);
  } else {
    // è„šæœ¬åŠ è½½æˆåŠŸï¼Œç»§ç»­...
    loadScript('2.js', function(error, script) {
      if (error) {
        handleError(error);
      } else {
        // è„šæœ¬åŠ è½½æˆåŠŸï¼Œç»§ç»­...
        loadScript('3.js', function(error, script) {
          if (error) {
            handleError(error);
          } else {
            // ...åŠ è½½å®Œæ‰€æœ‰è„šæœ¬åç»§ç»­ (*)
          }
        });
      }
    });
  }
});
```

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿æ¯ä¸ªè¡Œä¸ºéƒ½æˆä¸ºä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°æ¥å°è¯•å‡è½»è¿™ç§é—®é¢˜ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```javascript
loadScript('1.js', step1);

function step1(error, script) {
  if (error) {
    handleError(error);
  } else {
    // ...
    loadScript('2.js', step2);
  }
}

function step2(error, script) {
  if (error) {
    handleError(error);
  } else {
    // ...
    loadScript('3.js', step3);
  }
}

function step3(error, script) {
  if (error) {
    handleError(error);
  } else {
    // ...åŠ è½½å®Œæ‰€æœ‰è„šæœ¬åç»§ç»­ (*)
  }
}
```

å®ƒçš„ä½œç”¨ç›¸åŒï¼Œä½†æ˜¯æ²¡æœ‰æ·±å±‚çš„åµŒå¥—äº†ï¼Œå› ä¸ºæˆ‘ä»¬å°†æ¯ä¸ªè¡Œä¸ºéƒ½ç¼–å†™æˆäº†ä¸€ä¸ªç‹¬ç«‹çš„é¡¶å±‚å‡½æ•°ã€‚

é—®é¢˜ï¼š

1. å¯è¯»æ€§å·®ï¼›é˜…è¯»æ—¶éœ€è¦åœ¨å„ä¸ªä»£ç å—ä¹‹é—´è·³è½¬ï¼›
2. åä¸º `step` çš„å‡½æ•°éƒ½æ˜¯ä¸€æ¬¡æ€§ä½¿ç”¨çš„ï¼Œåˆ›å»ºå®ƒä»¬å°±æ˜¯ä¸ºäº†é¿å…â€œå„è¿é‡‘å­—å¡”â€ã€‚æ²¡æœ‰äººä¼šåœ¨è¡Œä¸ºé“¾ä¹‹å¤–é‡ç”¨å®ƒä»¬ã€‚å› æ­¤ï¼Œè¿™é‡Œçš„å‘½åç©ºé—´æœ‰ç‚¹æ··ä¹±ã€‚

æœ‰å…¶ä»–æ–¹æ³•å¯ä»¥é¿å…æ­¤ç±»é‡‘å­—å¡”ã€‚æœ€å¥½çš„æ–¹æ³•ä¹‹ä¸€å°±æ˜¯ â€œpromiseâ€ã€‚





### 11.2 Promise

*detail:*

- [[JAVASCRIPT.INFO] Promise](https://javascript.info/promise-basics) 
- [[MDN] Using Promises](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises) 
- [[MDN] Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise) 
- [[MDN] Promise() constructor](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/Promise) 
- [[web.dev] JavaScript Promises](https://web.dev/promises/) 



#### Description


```javascript
let promise = new Promise(function(resolve, reject) {
  // executor (the producing code)
  // The function passed to new Promise is called the executor.
});
```

ç”± `new Promise` æ„é€ å™¨è¿”å›çš„ `promise` å¯¹è±¡å…·æœ‰ä»¥ä¸‹å†…éƒ¨å±æ€§ï¼š

- `state` â€”â€” æœ€åˆæ˜¯ `"pending"`ï¼Œç„¶ååœ¨ resolve è¢«è°ƒç”¨æ—¶å˜ä¸º `"fulfilled"`ï¼Œæˆ–è€…åœ¨ `reject` è¢«è°ƒç”¨æ—¶å˜ä¸º `"rejected"`ã€‚

- `result` â€”â€” æœ€åˆæ˜¯ `undefined`ï¼Œç„¶ååœ¨ `resolve(value)` è¢«è°ƒç”¨æ—¶å˜ä¸º `value`ï¼Œæˆ–è€…åœ¨ `reject(error)` è¢«è°ƒç”¨æ—¶å˜ä¸º `error`ã€‚

![image-promise_state.png](image-promise_state.png)

1. ä¼ é€’ç»™ `new Promise` çš„å‡½æ•°è¢«ç§°ä¸º **executor**ã€‚å®ƒåŒ…å«æœ€ç»ˆåº”äº§å‡ºç»“æœçš„ç”Ÿäº§è€…ä»£ç ã€‚
    > executor è¢«è‡ªåŠ¨ä¸”ç«‹å³è°ƒç”¨ï¼ˆé€šè¿‡ `new Promise`ï¼‰ã€‚

2. executor æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š`resolve` å’Œ `reject`ã€‚è¿™äº›å‡½æ•°ç”± JavaScript å¼•æ“é¢„å…ˆå®šä¹‰ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦åˆ›å»ºå®ƒä»¬ã€‚æˆ‘ä»¬éœ€è¦åœ¨ executor å‡†å¤‡å¥½æ—¶è°ƒç”¨ `resolve` æˆ– `reject`ï¼Œæ¥æ”¹å˜å¯¹åº”çš„ promise å¯¹è±¡çš„çŠ¶æ€ã€‚
    > å®ƒçš„å‚æ•° `resolve` å’Œ `reject` æ˜¯ç”± JavaScript è‡ªèº«æä¾›çš„å›è°ƒã€‚
    > æˆ‘ä»¬çš„ä»£ç ä»…åœ¨ executor çš„å†…éƒ¨ã€‚
    >
    > ä¸æœ€åˆçš„ â€œpendingâ€ promise ç›¸åï¼Œä¸€ä¸ª resolved æˆ– rejected çš„ promise éƒ½ä¼šè¢«ç§°ä¸º â€œsettledâ€ã€‚
    >
    > - `resolve(value)` â€”â€” å¦‚æœä»»åŠ¡æˆåŠŸå®Œæˆå¹¶å¸¦æœ‰ç»“æœ `value`ã€‚
    > - `reject(error)` â€”â€” å¦‚æœå‡ºç°äº† errorï¼Œ`error` å³ä¸º error å¯¹è±¡ã€‚
    >
    > æ‰§è¡Œå™¨å‡½æ•°å‚æ•°çš„åå­—å’Œå®é™…è°ƒç”¨çš„ resolve() å’Œ reject() æ— å…³ï¼Œå…³é”®åœ¨äºé¡ºåºï¼Œç¬¬ä¸€ä¸ªä»£è¡¨ resolve()ï¼Œç¬¬äºŒä¸ªä»£è¡¨ reject()ã€‚
    > 

:information_source:**è¿™åªèƒ½æœ‰ä¸€ä¸ªç»“æœæˆ–ä¸€ä¸ª error**
executor åªèƒ½è°ƒç”¨ä¸€ä¸ª `resolve` æˆ–ä¸€ä¸ª `reject`ã€‚ä»»ä½•çŠ¶æ€çš„æ›´æ”¹éƒ½æ˜¯æœ€ç»ˆçš„ã€‚
æ‰€æœ‰å…¶ä»–çš„å†å¯¹ `resolve` å’Œ `reject` çš„è°ƒç”¨éƒ½ä¼šè¢«å¿½ç•¥ï¼š

```javascript
let promise = new Promise(function(resolve, reject) {
  resolve("done");

  reject(new Error("â€¦")); // è¢«å¿½ç•¥
  setTimeout(() => resolve("â€¦")); // è¢«å¿½ç•¥
});
```
è¿™çš„å®—æ—¨æ˜¯ï¼Œä¸€ä¸ªè¢« executor å®Œæˆçš„å·¥ä½œåªèƒ½æœ‰ä¸€ä¸ªç»“æœæˆ–ä¸€ä¸ª errorã€‚
å¹¶ä¸”ï¼Œ`resolve/reject` åªéœ€è¦ä¸€ä¸ªå‚æ•°ï¼ˆæˆ–ä¸åŒ…å«ä»»ä½•å‚æ•°ï¼‰ï¼Œå¹¶ä¸”å°†å¿½ç•¥é¢å¤–çš„å‚æ•°ã€‚

:information_source:**ä»¥ Error å¯¹è±¡ reject**
å¦‚æœä»€ä¹ˆä¸œè¥¿å‡ºäº†é—®é¢˜ï¼Œexecutor åº”è¯¥è°ƒç”¨ `reject`ã€‚è¿™å¯ä»¥ä½¿ç”¨ä»»ä½•ç±»å‹çš„å‚æ•°æ¥å®Œæˆï¼ˆå°±åƒ `resolve` ä¸€æ ·ï¼‰ã€‚ä½†å»ºè®®ä½¿ç”¨ `Error` å¯¹è±¡ï¼ˆæˆ–ç»§æ‰¿è‡ª `Error` çš„å¯¹è±¡ï¼‰ã€‚ç†ç”±ï¼š// **TODO**

:information_source:**resolve/reject å¯ä»¥ç«‹å³è¿›è¡Œ**
å®é™…ä¸Šï¼Œexecutor é€šå¸¸æ˜¯å¼‚æ­¥æ‰§è¡ŒæŸäº›æ“ä½œï¼Œå¹¶åœ¨ä¸€æ®µæ—¶é—´åè°ƒç”¨ `resolve/reject`ï¼Œä½†è¿™ä¸æ˜¯å¿…é¡»çš„ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ç«‹å³è°ƒç”¨ `resolve` æˆ– `reject`ï¼Œå°±åƒè¿™æ ·ï¼š

```javascript
let promise = new Promise(function(resolve, reject) {
  // ä¸èŠ±æ—¶é—´å»åšè¿™é¡¹å·¥ä½œ
  resolve(123); // ç«‹å³ç»™å‡ºç»“æœï¼š123
});
```
ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬å¼€å§‹åšä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œä½†éšåçœ‹åˆ°ä¸€åˆ‡éƒ½å·²ç»å®Œæˆå¹¶å·²è¢«ç¼“å­˜æ—¶ï¼Œå¯èƒ½å°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚
è¿™æŒºå¥½ã€‚æˆ‘ä»¬ç«‹å³å°±æœ‰äº†ä¸€ä¸ª resolved çš„ promiseã€‚

åœ¨ new Promise() çš„æ—¶å€™ï¼ŒPromise çš„æ‰§è¡Œå™¨å°±ä¼šç«‹é©¬æ‰§è¡Œï¼Œä½†æ˜¯**è°ƒç”¨ resolve() ä¼šè§¦å‘å¼‚æ­¥æ“ä½œï¼Œä¼ å…¥ then() æ–¹æ³•çš„å‡½æ•°ä¼šè¢«æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—å¹¶å¼‚æ­¥æ‰§è¡Œ**ã€‚ä»£ç ç¤ºä¾‹ï¼š[[CODEPEN] resolve()ç«‹å³æ‰§è¡Œä½†then()å¼‚æ­¥æ‰§è¡Œ](https://codepen.io/Vessel420/pen/gOzEemo)ã€‚

:information_source:**`state` å’Œ `result` éƒ½æ˜¯å†…éƒ¨çš„**
Promise å¯¹è±¡çš„ `state` å’Œ `result` å±æ€§éƒ½æ˜¯å†…éƒ¨çš„ã€‚æˆ‘ä»¬æ— æ³•ç›´æ¥è®¿é—®å®ƒä»¬ã€‚ä½†æˆ‘ä»¬å¯ä»¥å¯¹å®ƒä»¬ä½¿ç”¨ `.then`/`.catch`/`.finally` æ–¹æ³•ã€‚



#### Consumers: then, catch

Promise å¯¹è±¡å……å½“çš„æ˜¯ executorï¼ˆâ€œç”Ÿäº§è€…ä»£ç â€ï¼‰å’Œæ¶ˆè´¹å‡½æ•°ä¹‹é—´çš„è¿æ¥ï¼Œåè€…å°†æ¥æ”¶ç»“æœæˆ– errorã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨ `.then` å’Œ `.catch` æ–¹æ³•æ³¨å†Œæ¶ˆè´¹å‡½æ•°ã€‚



##### then

`.then` çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†åœ¨ promise resolved ä¸”æ¥æ”¶åˆ°ç»“æœåæ‰§è¡Œã€‚

`.then` çš„ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†åœ¨ promise rejected ä¸”æ¥æ”¶åˆ° error ä¿¡æ¯åæ‰§è¡Œã€‚

```javascript
promise.then(
	function(result) { /* handle a successful result */ },
	function(error) { /* handle an error */ }
);
```

```javascript
let promise = new Promise(function(resolve, reject) {
	setTimeout(() => resolve("done!"), 1000);
	setTimeout(() => reject(new Error("Whoops!")), 1000);
});

// åªä¼šè¿è¡Œå…¶ä¸­ä¸€ä¸ªã€‚
// resolve è¿è¡Œ .then ä¸­çš„ç¬¬ä¸€ä¸ªå‡½æ•°
// reject è¿è¡Œ .then ä¸­çš„ç¬¬äºŒä¸ªå‡½æ•°
promise.then(
	result => alert(result), // 1 ç§’åæ˜¾ç¤º "done!"
	error => alert(error) // 1 ç§’åæ˜¾ç¤º "Error: Whoops!"
);
```

å¦‚æœæˆ‘ä»¬åªå¯¹æˆåŠŸå®Œæˆçš„æƒ…å†µæ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆæˆ‘ä»¬<u>**å¯ä»¥åªä¸º `.then` æä¾›ä¸€ä¸ªå‡½æ•°å‚æ•°**</u>ï¼š:arrow_heading_down:

```javascript
let promise = new Promise(resolve => {
	setTimeout(() => resolve("done!"), 1000);
});
promise.then(alert); // 1 ç§’åæ˜¾ç¤º "done!"
```



##### catch

å¦‚æœæˆ‘ä»¬åªå¯¹ error æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `null` ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼š`.then(null, errorHandlingFunction)`ã€‚æˆ–è€…æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ `.catch(errorHandlingFunction)`ï¼Œå…¶å®æ˜¯ä¸€æ ·çš„ã€‚

`.catch(f)` è°ƒç”¨æ˜¯ `.then(null, f)` çš„å®Œå…¨çš„æ¨¡æ‹Ÿï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç®€å†™å½¢å¼ã€‚

```javascript
let promise = new Promise((resolve, reject) => {
  setTimeout(() => reject(new Error("Whoops!")), 1000);
});

// .catch(f) ä¸ promise.then(null, f) ä¸€æ ·
promise.catch(alert); // 1 ç§’åæ˜¾ç¤º "Error: Whoops!"
```



#### Cleanup: finally

è°ƒç”¨ `.finally(f)` ç±»ä¼¼äº `.then(f, f)`ï¼Œå› ä¸ºå½“ promise settled æ—¶ `f` å°±ä¼šæ‰§è¡Œï¼šæ— è®º promise è¢« resolve è¿˜æ˜¯ rejectã€‚

`finally` çš„åŠŸèƒ½æ˜¯è®¾ç½®ä¸€ä¸ªå¤„ç†ç¨‹åºåœ¨å‰é¢çš„æ“ä½œå®Œæˆåï¼Œæ‰§è¡Œæ¸…ç†/ç»ˆç»“ã€‚

```javascript
new Promise((resolve, reject) => {
  /* åšä¸€äº›éœ€è¦æ—¶é—´çš„äº‹ï¼Œä¹‹åè°ƒç”¨å¯èƒ½ä¼š resolve ä¹Ÿå¯èƒ½ä¼š reject */
})
  // åœ¨ promise ä¸º settled æ—¶è¿è¡Œï¼Œæ— è®ºæˆåŠŸä¸å¦
  .finally(() => stop loading indicator)
  // æ‰€ä»¥ï¼ŒåŠ è½½æŒ‡ç¤ºå™¨ï¼ˆloading indicatorï¼‰å§‹ç»ˆä¼šåœ¨æˆ‘ä»¬ç»§ç»­ä¹‹å‰åœæ­¢
  .then(result => show result, err => show error)
```

**:information_source:æ³¨æ„ï¼Œ`finally(f)` å¹¶ä¸å®Œå…¨æ˜¯ `then(f,f)` çš„åˆ«åã€‚å®ƒä»¬ä¹‹é—´æœ‰é‡è¦çš„åŒºåˆ«ï¼š**

1. `finally` å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰æ²¡æœ‰å‚æ•°ã€‚åœ¨ `finally` ä¸­ï¼Œæˆ‘ä»¬ä¸çŸ¥é“ promise æ˜¯å¦æˆåŠŸã€‚æ²¡å…³ç³»ï¼Œå› ä¸ºæˆ‘ä»¬çš„ä»»åŠ¡é€šå¸¸æ˜¯æ‰§è¡Œâ€œå¸¸è§„â€çš„å®Œæˆç¨‹åºï¼ˆfinalizing proceduresï¼‰ã€‚

2. `finally` å¤„ç†ç¨‹åºå°†ç»“æœæˆ– error â€œä¼ é€’â€ç»™ä¸‹ä¸€ä¸ªåˆé€‚çš„å¤„ç†ç¨‹åºã€‚
     ç¬¬ä¸€ä¸ª promise è¿”å›çš„ `value` é€šè¿‡ `finally` è¢«ä¼ é€’ç»™äº†ä¸‹ä¸€ä¸ª `then`ã€‚

3. `finally` å¤„ç†ç¨‹åºä¹Ÿä¸åº”è¯¥è¿”å›ä»»ä½•å†…å®¹ã€‚å¦‚æœå®ƒè¿”å›äº†ï¼Œè¿”å›çš„å€¼ä¼šé»˜è®¤è¢«å¿½ç•¥ã€‚
     æ­¤è§„åˆ™çš„å”¯ä¸€ä¾‹å¤–æ˜¯å½“ `finally` å¤„ç†ç¨‹åºæŠ›å‡º error æ—¶ã€‚æ­¤æ—¶è¿™ä¸ª errorï¼ˆè€Œä¸æ˜¯ä»»ä½•ä¹‹å‰çš„ç»“æœï¼‰ä¼šè¢«è½¬åˆ°æœ€è¿‘çš„ error çš„å¤„ç†ç¨‹åºã€‚

:information_source:**æˆ‘ä»¬å¯ä»¥å¯¹ settled çš„ promise é™„åŠ å¤„ç†ç¨‹åº**
å¦‚æœ promise ä¸º pending çŠ¶æ€ï¼Œ`.then`/`.catch`/`.finally` å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰å°†ç­‰å¾…å®ƒçš„ç»“æœã€‚
æœ‰æ—¶å€™ï¼Œå½“æˆ‘ä»¬å‘ä¸€ä¸ª promise æ·»åŠ å¤„ç†ç¨‹åºæ—¶ï¼Œå®ƒå¯èƒ½å·²ç» settled äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™äº›å¤„ç†ç¨‹åºä¼šç«‹å³æ‰§è¡Œï¼š

```javascript
// ä¸‹é¢è¿™ promise åœ¨è¢«åˆ›å»ºåç«‹å³å˜ä¸º resolved çŠ¶æ€
let promise = new Promise(resolve => resolve("done!"));

promise.then(alert); // done!ï¼ˆç°åœ¨æ˜¾ç¤ºï¼‰
```
Promise çµæ´»åœ¨äºï¼Œæˆ‘ä»¬å¯ä»¥éšæ—¶æ·»åŠ å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰ï¼šå¦‚æœç»“æœå·²ç»åœ¨äº†ï¼Œå®ƒä»¬å°±ä¼šæ‰§è¡Œã€‚



#### Example: loadScript

promise é‡å†™å¼‚æ­¥åŠ è½½ï¼š[[CODEPEN] å¼‚æ­¥å¸¸è§æ¡ˆä¾‹ä¹‹å›¾ç‰‡åŠ è½½](https://codepen.io/Vessel420/pen/MWGZRVO)

> éœ€è¦å¼€å¯æ§åˆ¶å°ç¦ç”¨ç½‘ç»œç¼“å­˜ã€‚

ç”¨ promise é‡å†™ *PART 1 - 11.1 Introduction: callbacks - Handling errors* ä¸­çš„ä»£ç å—ã€‚

```javascript
function loadScript(src) {
  return new Promise(function(resolve, reject) {
    let script = document.createElement('script');
    script.src = src;

    script.onload = () => resolve(script);
    script.onerror = () => reject(new Error(`Script load error for ${src}`));

    document.head.append(script);
  });
}

let promise = loadScript('./script.js');

promise.then(
  script => alert(`${script.src} is loaded!`),
  error => alert(`Error: ${error.message}`)
);
promise.then(script => alert('Another handler...'));
```

promise ä¸ åŸºäºå›è°ƒ æ¨¡å¼çš„å¯¹æ¯”ï¼š

| promise                                                      | callback                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| promise å…è®¸æˆ‘ä»¬æŒ‰ç…§è‡ªç„¶é¡ºåºè¿›è¡Œç¼–ç ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¿è¡Œ `loadScript` å’Œ `.then` æ¥å¤„ç†ç»“æœã€‚ | åœ¨è°ƒç”¨ `loadScript(script, callback)` æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æœ‰ä¸€ä¸ª `callback` å‡½æ•°å¯ä¾›ä½¿ç”¨ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨è°ƒç”¨ `loadScript` **ä¹‹å‰**ï¼Œæˆ‘ä»¬å¿…é¡»çŸ¥é“å¦‚ä½•å¤„ç†ç»“æœã€‚ |
| æˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦ï¼Œåœ¨ promise ä¸Šå¤šæ¬¡è°ƒç”¨ `.then`ã€‚æ¯æ¬¡è°ƒç”¨ï¼Œæˆ‘ä»¬éƒ½ä¼šåœ¨â€œè®¢é˜…åˆ—è¡¨â€ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„â€œç²‰ä¸â€ï¼Œä¸€ä¸ªæ–°çš„è®¢é˜…å‡½æ•°ã€‚ | åªèƒ½æœ‰ä¸€ä¸ªå›è°ƒã€‚                                             |



*æ¡ˆä¾‹ï¼š*

**åŸºäº promise çš„å»¶æ—¶**

åœ¨æ­¤ä»»åŠ¡ä¸­ `resolve` æ˜¯ä¸å¸¦å‚æ•°è°ƒç”¨çš„ã€‚æˆ‘ä»¬ä¸ä» `delay` ä¸­è¿”å›ä»»ä½•å€¼ï¼Œåªæ˜¯ç¡®ä¿å»¶è¿Ÿå³å¯ã€‚

```javascript
function delay(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

delay(3000).then(() => alert('runs after 3 seconds'));
```





### 11.3 Promise chaining

ç”¨ promise é‡å†™ *PART 1 - 11.1 Introduction: callbacks - Callback in callback* ä¸­çš„ç³»åˆ—å¼‚æ­¥ä»»åŠ¡ï¼š

```javascript
new Promise(function(resolve, reject) {
    setTimeout(() => resolve(1), 1000); // (*)
}).then(function(result) { // (**)
    alert(result); // 1
    return result * 2;
}).then(function(result) { // (***)
    alert(result); // 2
    return result * 2;
}).then(function(result) {
    alert(result); // 4
    return result * 2;
});
```

> å®ƒçš„æƒ³æ³•æ˜¯é€šè¿‡ `.then` å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰é“¾è¿›è¡Œä¼ é€’ resultã€‚
>
> è¿è¡Œæµç¨‹å¦‚ä¸‹ï¼š
>
> 1. åˆå§‹ promise åœ¨ 1 ç§’å resolve `(*)`ï¼Œ
> 2. ç„¶å `.then` å¤„ç†ç¨‹åºè¢«è°ƒç”¨ `(**)`ï¼Œå®ƒåˆåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ promiseï¼ˆä»¥ `2` ä½œä¸ºå€¼ resolveï¼‰ã€‚
> 3. ä¸‹ä¸€ä¸ª `then` `(***)` å¾—åˆ°äº†å‰ä¸€ä¸ª `then` çš„å€¼ï¼Œå¯¹è¯¥å€¼è¿›è¡Œå¤„ç†ï¼ˆ*2ï¼‰å¹¶å°†å…¶ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†ç¨‹åºã€‚
> 4. â€¦â€¦ä¾æ­¤ç±»æ¨ã€‚
>
> éšç€ result åœ¨å¤„ç†ç¨‹åºé“¾ä¸­ä¼ é€’ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ç³»åˆ—çš„ `alert` è°ƒç”¨ï¼š`1` â†’ `2` â†’ `4`ã€‚

è¿™æ ·ä¹‹æ‰€ä»¥æ˜¯å¯è¡Œçš„ï¼Œæ˜¯å› ä¸ºæ¯ä¸ªå¯¹ `.then` çš„è°ƒç”¨éƒ½ä¼šè¿”å›äº†ä¸€ä¸ªæ–°çš„ promiseï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¹‹ä¸Šè°ƒç”¨ä¸‹ä¸€ä¸ª `.then`ã€‚

![image-chain_call](image-chain_call.png)

> :information_desk_person:**æ–°æ‰‹å¸¸çŠ¯çš„ä¸€ä¸ªç»å…¸é”™è¯¯ï¼šä»æŠ€æœ¯ä¸Šè®²ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å¤šä¸ª `.then` æ·»åŠ åˆ°ä¸€ä¸ª promise ä¸Šã€‚ä½†è¿™å¹¶ä¸æ˜¯ promise é“¾ï¼ˆchainingï¼‰ã€‚**
>
> å¦‚ä¸‹:arrow_heading_down::x:
> 
> ```javascript
> let promise = new Promise(function(resolve, reject) {
>     setTimeout(() => resolve(1), 1000);
> });
> promise.then(function(result) {
>     alert(result); // 1
>     return result * 2;
> });
> promise.then(function(result) {
>     alert(result); // 1
>     return result * 2;
> });
> promise.then(function(result) {
>     alert(result); // 1
>     return result * 2;
> });
> ```
> 
> æˆ‘ä»¬åœ¨è¿™é‡Œæ‰€åšçš„åªæ˜¯ä¸€ä¸ª promise çš„å‡ ä¸ªå¤„ç†ç¨‹åºã€‚å®ƒä»¬ä¸ä¼šç›¸äº’ä¼ é€’ resultï¼›ç›¸åï¼Œå®ƒä»¬ä¹‹é—´å½¼æ­¤ç‹¬ç«‹è¿è¡Œå¤„ç†ä»»åŠ¡ã€‚
> åœ¨åŒä¸€ä¸ª promise ä¸Šçš„æ‰€æœ‰ `.then` è·å¾—çš„ç»“æœéƒ½ç›¸åŒ â€”â€” è¯¥ promise çš„ç»“æœã€‚
>
> ![image-independent_call](image-independent_call.png)
>



#### Returning promises

`.then(handler)` ä¸­æ‰€ä½¿ç”¨çš„å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰å¯ä»¥åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª promiseã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¶ä»–çš„å¤„ç†ç¨‹åºå°†ç­‰å¾…å®ƒ settled åå†è·å¾—å…¶ç»“æœã€‚å¦‚:arrow_heading_down:

```javascript
new Promise(function(resolve, reject) {
    setTimeout(() => resolve(1), 1000);
}).then(function(result) {
    alert(result); // 1
    return new Promise((resolve, reject) => { // (*)
        setTimeout(() => resolve(result * 2), 1000);
    });
}).then(function(result) { // (**)
    alert(result); // 2
    return new Promise((resolve, reject) => {
        setTimeout(() => resolve(result * 2), 1000);
    });
}).then(function(result) {
    alert(result); // 4
});
```

è¿”å› promise ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ„å»ºå¼‚æ­¥è¡Œä¸ºé“¾ã€‚



#### Example: loadScript

ç»“åˆ *PART 1 - 11.2 Promise - Example: loadScript* æŒ‰é¡ºåºä¾æ¬¡åŠ è½½è„šæœ¬ã€‚:arrow_heading_down:

```javascript
loadScript("./script_1.js")
    .then(function(script) {
    	return loadScript("./script_2.js");
	})
    .then(function(script) {
    	return loadScript("./script_3.js");
  	})
  	.then(function(script) {
    	// ä½¿ç”¨åœ¨è„šæœ¬ä¸­å£°æ˜çš„å‡½æ•°
    	// ä»¥è¯æ˜è„šæœ¬ç¡®å®è¢«åŠ è½½å®Œæˆäº†
        one();
        two();
        three();
	});
```

ä½¿ç”¨ç®­å¤´å‡½æ•°é‡å†™ä»¥ç®€åŒ–ã€‚:arrow_heading_down:

```javascript
loadScript("./script_1.js")
	.then(script => loadScript("./script_2.js"))
	.then(script => loadScript("./script_3.js"))
	.then(script => {
    	// è„šæœ¬åŠ è½½å®Œæˆï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™å„¿ä½¿ç”¨è„šæœ¬ä¸­å£°æ˜çš„å‡½æ•°
    	one();
    	two();
    	three();
	})
```

> æˆ‘ä»¬å¯ä»¥å‘é“¾ä¸­æ·»åŠ æ›´å¤šçš„å¼‚æ­¥è¡Œä¸ºã€‚è¯·æ³¨æ„ï¼Œä»£ç ä»ç„¶æ˜¯â€œæ‰å¹³â€çš„ â€”â€” å®ƒå‘ä¸‹å¢é•¿ï¼Œè€Œä¸æ˜¯å‘å³ã€‚è¿™é‡Œæ²¡æœ‰â€œå„è¿é‡‘å­—å¡”â€çš„è¿¹è±¡ã€‚

ä»æŠ€æœ¯ä¸Šè®²ï¼Œæˆ‘ä»¬å¯ä»¥å‘æ¯ä¸ª `loadScript` ç›´æ¥æ·»åŠ  `.then`ï¼Œå°±åƒè¿™æ · :arrow_heading_down:

```javascript
loadScript("./script_1.js").then(script1 => {
    loadScript("./script_2.js").then(script2 => {
        loadScript("./script_3.js").then(script3 => {
            // æ­¤å‡½æ•°å¯ä»¥è®¿é—®å˜é‡ script1ï¼Œscript2 å’Œ script3
            one();
            two();
            three();
        });
    });
});
```

> è¿™æ®µä»£ç åšäº†ç›¸åŒçš„äº‹å„¿ï¼šæŒ‰é¡ºåºåŠ è½½ 3 ä¸ªè„šæœ¬ã€‚ä½†å®ƒæ˜¯â€œå‘å³å¢é•¿â€çš„ã€‚æ‰€ä»¥ä¼šæœ‰å’Œä½¿ç”¨å›è°ƒå‡½æ•°ä¸€æ ·çš„é—®é¢˜ã€‚
>
> :grey_exclamation:æœ‰æ—¶å€™ç›´æ¥å†™ `.then` ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºåµŒå¥—çš„å‡½æ•°å¯ä»¥è®¿é—®å¤–éƒ¨ä½œç”¨åŸŸã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒåµŒå¥—åœ¨æœ€æ·±å±‚çš„é‚£ä¸ªå›è°ƒï¼ˆcallbackï¼‰å¯ä»¥è®¿é—®æ‰€æœ‰å˜é‡ `script1`ï¼Œ`script2` å’Œ `script3`ã€‚ä½†è¿™æ˜¯ä¸€ä¸ªä¾‹å¤–ï¼Œè€Œä¸æ˜¯ä¸€æ¡è§„åˆ™ã€‚

##### :information_source:Thenables

*details:*

- [[MDN] Thenables](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise#thenables)
- [[MDN] Promise.resolve()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/resolve)

ç¡®åˆ‡åœ°è¯´ï¼Œå¤„ç†ç¨‹åºè¿”å›çš„ä¸å®Œå…¨æ˜¯ä¸€ä¸ª promiseï¼Œè€Œæ˜¯è¿”å›çš„è¢«ç§°ä¸º â€œthenableâ€ çš„å¯¹è±¡ :point_right: ä¸€ä¸ªå…·æœ‰æ–¹æ³• `.then` çš„ä»»æ„å¯¹è±¡ã€‚å®ƒä¼šè¢«å½“åšä¸€ä¸ª promise æ¥å¯¹å¾…ã€‚

è¿™ä¸ªæƒ³æ³•æ˜¯ï¼Œç¬¬ä¸‰æ–¹åº“å¯ä»¥å®ç°è‡ªå·±çš„â€œpromise å…¼å®¹ï¼ˆpromise-compatibleï¼‰â€å¯¹è±¡ã€‚å®ƒä»¬å¯ä»¥å…·æœ‰æ‰©å±•çš„æ–¹æ³•é›†ï¼Œä½†ä¹Ÿä¸åŸç”Ÿçš„ promise å…¼å®¹ï¼Œå› ä¸ºå®ƒä»¬å®ç°äº† `.then` æ–¹æ³•ã€‚

> ä¸€ä¸ª thenable å¯¹è±¡çš„ç¤ºä¾‹ â¤µ

```javascript
class Thenable {
	constructor(num) {
		this.num = num;
	}
	then(resolve, reject) {
		alert(resolve); // function() { native code }
		// 1 ç§’åä½¿ç”¨ this.num*2 è¿›è¡Œ resolve
		setTimeout(() => resolve(this.num * 2), 1000); // (**)
	}
}

new Promise(resolve => resolve(1))
	.then(result => {
		return new Thenable(result); // (*)
	})
	.then(alert); // 1000ms åæ˜¾ç¤º 2
```

> JavaScript æ£€æŸ¥åœ¨ `(*)` è¡Œä¸­ç”± `.then` å¤„ç†ç¨‹åºè¿”å›çš„å¯¹è±¡ï¼šå¦‚æœå®ƒå…·æœ‰åä¸º `then` çš„å¯è°ƒç”¨æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°†è°ƒç”¨è¯¥æ–¹æ³•å¹¶**æä¾›åŸç”Ÿçš„å‡½æ•° `resolve` å’Œ `reject` ä½œä¸ºå‚æ•°**ï¼ˆç±»ä¼¼äº executorï¼‰ï¼Œå¹¶ç­‰å¾…ç›´åˆ°å…¶ä¸­ä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ`resolve(2)` åœ¨ 1 ç§’åè¢«è°ƒç”¨ `(**)`ã€‚ç„¶åï¼Œresult ä¼šè¢«è¿›ä¸€æ­¥æ²¿ç€é“¾å‘ä¸‹ä¼ é€’ã€‚
>
> è¿™ä¸ªç‰¹æ€§å…è®¸æˆ‘ä»¬å°†è‡ªå®šä¹‰çš„å¯¹è±¡ä¸ promise é“¾é›†æˆåœ¨ä¸€èµ·ï¼Œè€Œä¸å¿…ç»§æ‰¿è‡ª `Promise`ã€‚



#### Bigger example: fetch

åœ¨å‰ç«¯ç¼–ç¨‹ä¸­ï¼Œpromise é€šå¸¸è¢«ç”¨äºç½‘ç»œè¯·æ±‚ã€‚ä½¿ç”¨ fetch æ–¹æ³•ä»è¿œç¨‹æœåŠ¡å™¨åŠ è½½ç”¨æˆ·ä¿¡æ¯ã€‚

> Fetch å‚è€ƒ *PART 3 - 3.1 Fetch*

```javascript
// æ‰§è¡Œè¿™æ¡è¯­å¥ï¼Œå‘ url å‘å‡ºç½‘ç»œè¯·æ±‚å¹¶è¿”å›ä¸€ä¸ª promiseã€‚
// å½“è¿œç¨‹æœåŠ¡å™¨è¿”å› headerï¼ˆæ˜¯åœ¨ å…¨éƒ¨å“åº”åŠ è½½å®Œæˆå‰ï¼‰æ—¶ï¼Œ
// è¯¥ promise ä½¿ç”¨ä¸€ä¸ª response å¯¹è±¡æ¥è¿›è¡Œ resolveã€‚
fetch('/article/promise-chaining/user.json')
    // å½“è¿œç¨‹æœåŠ¡å™¨å“åº”æ—¶ï¼Œä¸‹é¢çš„ .then å¼€å§‹æ‰§è¡Œ
    .then(function(response) {
        // å½“ user.json åŠ è½½å®Œæˆæ—¶ï¼Œresponse.text() ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ promise
        // è¯¥ promise ä»¥åŠ è½½çš„ user.json ä¸º result è¿›è¡Œ resolve
        return response.text();
    })
    .then(function(text) {
        // â€¦â€¦è¿™æ˜¯è¿œç¨‹æ–‡ä»¶çš„å†…å®¹
        alert(text); // {"name": "iliakan", "isAdmin": true}
    });
```

ä» `fetch` è¿”å›çš„ `response` å¯¹è±¡è¿˜åŒ…å« `response.json()` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥è¯»å–è¿œç¨‹æ•°æ®å¹¶å°†å…¶è§£æä¸º JSONã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™æ›´åŠ æ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨è¿™ä¸ªæ–¹æ³•å§ã€‚:arrow_heading_down:

```javascript
// åŒä¸Šï¼Œä½†ä½¿ç”¨ response.json() å°†è¿œç¨‹å†…å®¹è§£æä¸º JSON
fetch('/article/promise-chaining/user.json')
    .then(response => response.json())
    .then(user => alert(user.name)); // iliakanï¼Œè·å–åˆ°äº†ç”¨æˆ·å
```

:arrow_down:å®ç°æ›´å¤š:arrow_down:

```javascript
// å‘é€ä¸€ä¸ªå¯¹ user.json çš„è¯·æ±‚
fetch('/article/promise-chaining/user.json')
    // å°†å…¶åŠ è½½ä¸º JSON
    .then(response => response.json())
    // å‘é€ä¸€ä¸ªåˆ° GitHub çš„è¯·æ±‚
    .then(user => fetch(`https://api.github.com/users/${user.name}`))
    // å°†å“åº”åŠ è½½ä¸º JSON
    .then(response => response.json())
    // æ˜¾ç¤ºå¤´åƒå›¾ç‰‡ï¼ˆgithubUser.avatar_urlï¼‰3 ç§’ï¼ˆä¹Ÿå¯ä»¥åŠ ä¸ŠåŠ¨ç”»æ•ˆæœï¼‰
    .then(githubUser => {
        let img = document.createElement('img');
        img.src = githubUser.avatar_url;
        img.className = "promise-avatar-example";
        document.body.append(img);

        setTimeout(() => img.remove(), 3000); // (*)
    });
```

:arrow_down:æ”¹è¿› `(*)` è¡Œï¼Œä½¿å¾—èƒ½åœ¨å¤´åƒæ˜¾ç¤ºç»“æŸå¹¶è¢«ç§»é™¤åèƒ½ç»§ç»­æ“ä½œï¼Œå³è®©é“¾å¯æ‰©å±•ã€‚:arrow_down:

```javascript
fetch('/article/promise-chaining/user.json')
    .then(response => response.json())
    .then(user => fetch(`https://api.github.com/users/${user.name}`))
    .then(response => response.json())
    .then(githubUser => new Promise(function(resolve, reject) { // (*)
        let img = document.createElement('img');
        img.src = githubUser.avatar_url;
        img.className = "promise-avatar-example";
        document.body.append(img);

        setTimeout(() => {
            img.remove();
            resolve(githubUser); // (**)
        }, 3000);
    }))
	// 3 ç§’åè§¦å‘
    .then(githubUser => alert(`Finished showing ${githubUser.name}`));
```

:handshake:ä½œä¸ºä¸€ä¸ªå¥½çš„åšæ³•ï¼Œå¼‚æ­¥è¡Œä¸ºåº”è¯¥å§‹ç»ˆè¿”å›ä¸€ä¸ª promiseã€‚è¿™æ ·å°±å¯ä»¥ä½¿å¾—ä¹‹åæˆ‘ä»¬è®¡åˆ’åç»­çš„è¡Œä¸ºæˆä¸ºå¯èƒ½ã€‚å³ä½¿æˆ‘ä»¬ç°åœ¨ä¸æ‰“ç®—å¯¹é“¾è¿›è¡Œæ‰©å±•ï¼Œä½†æˆ‘ä»¬ä¹‹åå¯èƒ½ä¼šéœ€è¦ã€‚

:arrow_down:æœ€åï¼Œå°†ä»£ç æ‹†åˆ†ä¸ºå¯é‡ç”¨çš„å‡½æ•°ã€‚:arrow_down:

```javascript
function loadJson(url) {
    return fetch(url)
        .then(response => response.json());
}

function loadGithubUser(name) {
    return loadJson(`https://api.github.com/users/${name}`);
}

function showAvatar(githubUser) {
    return new Promise(function(resolve, reject) {
        let img = document.createElement('img');
        img.src = githubUser.avatar_url;
        img.className = "promise-avatar-example";
        document.body.append(img);

        setTimeout(() => {
            img.remove();
            resolve(githubUser);
        }, 3000);
    });
}

// ä½¿ç”¨å®ƒä»¬ï¼š
loadJson('/article/promise-chaining/user.json')
    .then(user => loadGithubUser(user.name))
    .then(showAvatar)
    .then(githubUser => alert(`Finished showing ${githubUser.name}`));
	// ...
```



#### Summary

å¦‚æœ `.then`ï¼ˆæˆ– `.catch`/`.finally` éƒ½å¯ä»¥ï¼‰å¤„ç†ç¨‹åºè¿”å›ä¸€ä¸ª promiseï¼Œé‚£ä¹ˆé“¾çš„å…¶ä½™éƒ¨åˆ†å°†ä¼šç­‰å¾…ï¼Œç›´åˆ°å®ƒçŠ¶æ€å˜ä¸º settledã€‚å½“å®ƒè¢« settled åï¼Œå…¶ resultï¼ˆæˆ– errorï¼‰å°†è¢«è¿›ä¸€æ­¥ä¼ é€’ä¸‹å»ã€‚

![image-promise-chaining-workflow](image-promise-chaining-workflow.png)



*æ¡ˆä¾‹ï¼š*

**Promise: then å¯¹æ¯” catch**

`promise.then(f1).catch(f2); // (*)` ä¸ `promise.then(f1, f2); // (**)` ä¸ç›¸ç­‰ã€‚

ä¸åŒä¹‹å¤„åœ¨äºï¼š

å¦‚æœ `f1` ä¸­å‡ºç° errorï¼Œåœ¨ä»£ç ï¼ˆ*ï¼‰ä¸­å®ƒä¼šè¢« `.catch` å¤„ç†ï¼Œåœ¨ä»£ç ï¼ˆ**ï¼‰ä¸­åˆ™ä¸ä¼šã€‚

è¿™æ˜¯å› ä¸º **error æ˜¯æ²¿ç€é“¾ä¼ é€’çš„**ï¼Œè€Œåœ¨ç¬¬äºŒæ®µä»£ç ä¸­ï¼Œ`f1` ä¸‹é¢æ²¡æœ‰é“¾ã€‚

æ¢å¥è¯è¯´ï¼Œ`.then` å°† result/error ä¼ é€’ç»™ä¸‹ä¸€ä¸ª `.then`/`.catch`ã€‚æ‰€ä»¥åœ¨ä¾‹å­ (*) ä¸­ï¼Œåœ¨ä¸‹é¢æœ‰ä¸€ä¸ª `.catch`ï¼Œè€Œåœ¨ä¾‹å­ (**) ä¸­å¹¶æ²¡æœ‰ `.catch`ï¼Œæ‰€ä»¥ error æœªè¢«å¤„ç†ã€‚





### 11.4 Error handling with promises

promise é“¾åœ¨é”™è¯¯ï¼ˆerrorï¼‰å¤„ç†ä¸­ååˆ†å¼ºå¤§ã€‚

å½“ä¸€ä¸ª promise è¢« reject æ—¶ï¼Œæ§åˆ¶æƒå°†ç§»äº¤è‡³æœ€è¿‘çš„ rejection å¤„ç†ç¨‹åºã€‚è¿™åœ¨å®é™…å¼€å‘ä¸­éå¸¸æ–¹ä¾¿ã€‚

- è‹¥ `fetch` çš„ URL æ˜¯é”™çš„ï¼Œ`.catch` å¯¹è¿™ä¸ª error è¿›è¡Œå¤„ç†ï¼Œä½† `.catch` ä¸å¿…æ˜¯ç«‹å³çš„ï¼Œå®ƒå¯èƒ½åœ¨ä¸€ä¸ªæˆ–å¤šä¸ª `.then` ä¹‹åå‡ºç°ã€‚

- æˆ–è€…ç½‘ç«™æ­£å¸¸ï¼Œä½†å“åº”ä¸æ˜¯æœ‰æ•ˆçš„ JSONã€‚æ•è·æ‰€æœ‰ error çš„æœ€ç®€å•çš„æ–¹æ³•æ˜¯ï¼Œå°† `.catch` é™„åŠ åˆ°é“¾çš„æœ«å°¾ã€‚

	> é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™æ ·çš„ `.catch` æ ¹æœ¬ä¸ä¼šè¢«è§¦å‘ã€‚ä½†æ˜¯å¦‚æœ promise é“¾ä¸­ä¼—å¤šçš„ `.then` ä¸­ä»»æ„ä¸€ä¸ªè¿”å›çš„ promise rejectedï¼ˆç½‘ç»œé—®é¢˜æˆ–è€…æ— æ•ˆçš„ json æˆ–å…¶ä»–ï¼‰ï¼Œ`.catch` å°±ä¼šæ•è·å®ƒã€‚



#### Implicit try...catch

**promise çš„æ‰§è¡Œè€…ï¼ˆexecutorï¼‰**å’Œ **promise çš„å¤„ç†ç¨‹åº**å‘¨å›´æœ‰ä¸€ä¸ªâ€œéšå¼çš„ `try...catch`â€ã€‚å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œå®ƒå°±ä¼šè¢«æ•è·ï¼Œå¹¶è¢«è§†ä¸º rejection è¿›è¡Œå¤„ç†ã€‚

```javascript
new Promise((resolve, reject) => {
    throw new Error("Whoops!"); // (*)
}).catch(alert); // Error: Whoops!

new Promise((resolve, reject) => {
    reject(new Error("Whoops!")); // (**)
}).catch(alert); // Error: Whoops!
```

ä»¥ä¸Šä¸¤ä¸ªä»£ç å—çš„å·¥ä½œå®Œå…¨ç›¸åŒã€‚:arrow_heading_up:



**åœ¨ executor å‘¨å›´çš„ â€œéšå¼ `try..catch`â€ è‡ªåŠ¨æ•è·äº† errorï¼Œå¹¶å°†å…¶å˜ä¸º rejected promiseã€‚**

è¿™ä¸ä»…ä»…å‘ç”Ÿåœ¨ executor å‡½æ•°ä¸­ï¼ŒåŒæ ·ä¹Ÿå‘ç”Ÿåœ¨å…¶å¤„ç†ç¨‹åºä¸­ã€‚å¦‚æœæˆ‘ä»¬åœ¨ `.then` å¤„ç†ç¨‹åºä¸­ `throw`ï¼Œè¿™æ„å‘³ç€ promise rejectedï¼Œå› æ­¤æ§åˆ¶æƒç§»äº¤è‡³æœ€è¿‘çš„ error å¤„ç†ç¨‹åºã€‚`// (***)`

å¯¹äºæ‰€æœ‰çš„ error éƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œè€Œä¸ä»…ä»…æ˜¯ç”± `throw` è¯­å¥å¯¼è‡´çš„è¿™äº› errorã€‚`// (****)` :arrow_heading_down:

```javascript
new Promise((resolve, reject) => {
    resolve("ok");
}).then((result) => {
    throw new Error("Whoops!"); // reject è¿™ä¸ª promise // (***)
}).catch(alert); // Error: Whoops!

new Promise((resolve, reject) => {
    resolve("ok");
}).then((result) => {
    blabla(); // æ²¡æœ‰è¿™ä¸ªå‡½æ•° // (****) ç¼–ç¨‹é”™è¯¯
}).catch(alert); // ReferenceError: blabla is not defined
```

æœ€åçš„ `.catch` ä¸ä»…ä¼šæ•è·æ˜¾å¼çš„ rejectionï¼Œè¿˜ä¼šæ•è·å®ƒä¸Šé¢çš„å¤„ç†ç¨‹åºä¸­æ„å¤–å‡ºç°çš„ errorã€‚



#### Rethrowing

- å¦‚æœ `.catch` å—å¤„ç†è¯¥ error å¹¶æ­£å¸¸å®Œæˆï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªæˆåŠŸçš„ `.then` å¤„ç†ç¨‹åºå°±ä¼šè¢«è°ƒç”¨ã€‚:arrow_heading_down:

```javascript
// æ‰§è¡Œæµï¼šcatch -> then
new Promise((resolve, reject) => {
    throw new Error("Whoops!");
}).catch(function(error) {
    alert("The error is handled, continue normally");
}).then(() => alert("Next successful handler runs"));
```



- å¦‚æœæˆ‘ä»¬åœ¨ `.catch` ä¸­ `throw`ï¼Œé‚£ä¹ˆæ§åˆ¶æƒå°±ä¼šè¢«ç§»äº¤åˆ°ä¸‹ä¸€ä¸ªæœ€è¿‘çš„ error å¤„ç†ç¨‹åºã€‚:arrow_heading_down:

```javascript
// æ‰§è¡Œæµï¼šcatch -> catch
new Promise((resolve, reject) => {
    throw new Error("Whoops!");
}).catch(function(error) { // (*)
    if (error instanceof URIError) {
        // å¤„ç†å®ƒ
    } else {
        alert("Can't handle such error");
        throw error; // å†æ¬¡æŠ›å‡ºæ­¤ error æˆ–å¦å¤–ä¸€ä¸ª errorï¼Œæ‰§è¡Œå°†è·³è½¬è‡³ä¸‹ä¸€ä¸ª catch
    }
}).then(function() {
    /* ä¸åœ¨è¿™é‡Œè¿è¡Œ */
}).catch(error => { // (**)
    alert(`The unknown error has occurred: ${error}`);
    // ä¸ä¼šè¿”å›ä»»ä½•å†…å®¹ => æ‰§è¡Œæ­£å¸¸è¿›è¡Œ
});
```

> æ‰§è¡Œä»ç¬¬ä¸€ä¸ª `.catch` `(*)` æ²¿ç€é“¾è·³è½¬è‡³ä¸‹ä¸€ä¸ª `(**)`ã€‚



#### Unhandled rejections

å¦‚æœå‡ºç° errorï¼Œpromise çš„çŠ¶æ€å°†å˜ä¸º â€œrejectedâ€ï¼Œç„¶åæ‰§è¡Œåº”è¯¥è·³è½¬è‡³æœ€è¿‘çš„ rejection å¤„ç†ç¨‹åºã€‚

â€‹	:arrow_right: è‹¥æ²¡æœ‰è¿™æ ·çš„å¤„ç†ç¨‹åºï¼Œerror ä¼šâ€œå¡ä½â€ï¼Œæ²¡æœ‰ä»£ç æ¥å¤„ç†å®ƒã€‚

å½“å‘ç”Ÿä¸€ä¸ªå¸¸è§„çš„ error å¹¶ä¸”æœªè¢« `try..catch` æ•è·æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

â€‹	:arrow_right: è„šæœ¬æ­»äº†ï¼Œå¹¶åœ¨æ§åˆ¶å°ä¸­ç•™ä¸‹äº†ä¸€ä¸ªä¿¡æ¯ã€‚

â€‹	:arrow_right: å¯¹äºåœ¨ promise ä¸­æœªè¢«å¤„ç†çš„ rejectionï¼Œä¹Ÿä¼šå‘ç”Ÿç±»ä¼¼çš„äº‹ã€‚

â€‹	:arrow_right: JavaScript å¼•æ“ä¼šè·Ÿè¸ªæ­¤ç±» rejectionï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¼šç”Ÿæˆä¸€ä¸ªå…¨å±€çš„ errorã€‚



åœ¨æµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `unhandledrejection` äº‹ä»¶æ¥æ•è·è¿™ç±» errorï¼š

*detail:*

- [[MDN] Window: unhandledrejection event](https://developer.mozilla.org/en-US/docs/Web/API/Window/unhandledrejection_event)
- [[HTML Living Standard] 8.1.4.7 Unhandled promise rejections](https://html.spec.whatwg.org/multipage/webappapis.html#unhandled-promise-rejections)

```javascript
window.addEventListener('unhandledrejection', function(event) {
    // è¿™ä¸ªäº‹ä»¶å¯¹è±¡æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„å±æ€§ï¼š
    alert(event.promise); // [object Promise] â€”â€” ç”Ÿæˆè¯¥å…¨å±€ error çš„ promise
    alert(event.reason); // Error: Whoops! â€”â€” æœªå¤„ç†çš„ error å¯¹è±¡
});
new Promise(function() {
    throw new Error("Whoops!");
}); // æ²¡æœ‰ç”¨æ¥å¤„ç† error çš„ catch
```

å¦‚æœå‡ºç°äº†ä¸€ä¸ª errorï¼Œå¹¶ä¸”åœ¨è¿™æ²¡æœ‰ `.catch`ï¼Œé‚£ä¹ˆ `unhandledrejection` å¤„ç†ç¨‹åºå°±ä¼šè¢«è§¦å‘ï¼Œå¹¶è·å–å…·æœ‰ error ç›¸å…³ä¿¡æ¯çš„ `event` å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±èƒ½åšä¸€äº›åç»­å¤„ç†äº†ã€‚

> é€šå¸¸æ­¤ç±» error æ˜¯æ— æ³•æ¢å¤çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯å°†é—®é¢˜å‘ŠçŸ¥ç”¨æˆ·ï¼Œå¹¶ä¸”å¯ä»¥å°†äº‹ä»¶æŠ¥å‘Šç»™æœåŠ¡å™¨ã€‚
>
> åœ¨ Node.js ç­‰éæµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œæœ‰å…¶ä»–ç”¨äºè·Ÿè¸ªæœªå¤„ç†çš„ error çš„æ–¹æ³•ã€‚



#### Summary

- `.catch` å¤„ç† promise ä¸­çš„å„ç§ errorï¼šåœ¨ `reject()` è°ƒç”¨ä¸­çš„ï¼Œæˆ–è€…åœ¨å¤„ç†ç¨‹åºä¸­æŠ›å‡ºçš„ errorã€‚
- å¦‚æœç»™å®š `.then` çš„ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå³ error å¤„ç†ç¨‹åºï¼‰ï¼Œé‚£ä¹ˆ `.then` ä¹Ÿä¼šä»¥ç›¸åŒçš„æ–¹å¼æ•è· errorã€‚
- æˆ‘ä»¬åº”è¯¥å°† `.catch` å‡†ç¡®åœ°æ”¾åˆ°æˆ‘ä»¬æƒ³è¦å¤„ç† errorï¼Œå¹¶çŸ¥é“å¦‚ä½•å¤„ç†è¿™äº› error çš„åœ°æ–¹ã€‚å¤„ç†ç¨‹åºåº”è¯¥åˆ†æ errorï¼ˆå¯ä»¥è‡ªå®šä¹‰ error ç±»æ¥å¸®åŠ©åˆ†æï¼‰å¹¶å†æ¬¡æŠ›å‡ºæœªçŸ¥çš„ errorï¼ˆå®ƒä»¬å¯èƒ½æ˜¯ç¼–ç¨‹é”™è¯¯ï¼‰ã€‚
- å¦‚æœæ²¡æœ‰åŠæ³•ä» error ä¸­æ¢å¤ï¼Œä¸ä½¿ç”¨ `.catch` ä¹Ÿå¯ä»¥ã€‚
- åœ¨ä»»ä½•æƒ…å†µä¸‹æˆ‘ä»¬éƒ½åº”è¯¥æœ‰ `unhandledrejection` äº‹ä»¶å¤„ç†ç¨‹åºï¼ˆç”¨äºæµè§ˆå™¨ï¼Œä»¥åŠå…¶ä»–ç¯å¢ƒçš„æ¨¡æ‹Ÿï¼‰ï¼Œä»¥è·Ÿè¸ªæœªå¤„ç†çš„ error å¹¶å‘ŠçŸ¥ç”¨æˆ·ï¼ˆå¯èƒ½è¿˜æœ‰æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼‰æœ‰å…³ä¿¡æ¯ï¼Œä»¥ä½¿æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ°¸è¿œä¸ä¼šâ€œæ­»æ‰â€ã€‚



*æ¡ˆä¾‹ï¼š* [setTimeout ä¸­çš„é”™è¯¯](https://zh.javascript.info/task/error-async)

```javascript
new Promise(function(resolve, reject) {
    setTimeout(() => {
        throw new Error("Whoops 111!"); // Uncaught Error: Whoops 111! at...
        // reject(new Error("Whoops 222!")); // Error: Whoops 222!
    }, 1000);
}).catch(alert);
```

ä¸Šé¢çš„ `.catch` ä¸ä¼šè¢«è§¦å‘ã€‚æ§åˆ¶å°ä¼šå‡ºç°ï¼š`Uncaught Error: Whoops! at ......`

å¦‚æœ¬èŠ‚è§£é‡Šçš„ï¼Œ<u>promise çš„æ‰§è¡Œè€…ï¼ˆexecutorï¼‰å’Œ promise çš„å¤„ç†ç¨‹åº</u>å‘¨å›´æœ‰ä¸ªâ€œéšå¼çš„ `try..catch`â€ã€‚æ‰€ä»¥ï¼Œæ‰€æœ‰åŒæ­¥é”™è¯¯éƒ½ä¼šå¾—åˆ°å¤„ç†ã€‚

ä½†æ˜¯è¿™é‡Œçš„é”™è¯¯å¹¶ä¸æ˜¯åœ¨ executor è¿è¡Œæ—¶ç”Ÿæˆçš„ï¼Œè€Œæ˜¯åœ¨ç¨åç”Ÿæˆçš„ã€‚å› æ­¤ï¼Œpromise æ— æ³•å¤„ç†å®ƒã€‚

:question: é‚£ä¸ºä»€ä¹ˆé”™è¯¯æ˜¯ç¨åç”Ÿæˆçš„ï¼Œpromise å°±æ— æ³•å¤„ç†äº†å‘¢ã€‚

å‚è€ƒå›é¡¾ `try...catch` åŒæ­¥æ‰§è¡ŒåŸç† *PART 1 - 10.1 Error handling, "try...catch"* :arrow_heading_down:

å‘ç°

â€‹	:arrow_right: å¦‚æœä¸€ä¸ªå¼‚å¸¸å‘ç”Ÿåœ¨â€œè®¡åˆ’çš„â€ï¼ˆscheduledï¼‰ä»£ç ä¸­ï¼Œæ¯”å¦‚åœ¨ `setTimeout` ä¸­ï¼Œé‚£ä¹ˆ `try...catch` å°±ä¸ä¼šæ•è·å®ƒè¿™ä¸ªå¼‚å¸¸ã€‚å› ä¸º `try...catch` åŒ…è£¹äº†è®¡åˆ’è¦æ‰§è¡Œçš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æœ¬èº«è¦ç¨åæ‰æ‰§è¡Œï¼Œè¿™æ—¶å¼•æ“å·²ç»ç¦»å¼€äº† `try...catch` ç»“æ„ã€‚

ä¸Šé¢æ¡ˆä¾‹ä»£ç å—ç›¸å½“äºä¸‹é¢çš„ä»£ç å—ï¼š

```javascript
new Promise(function(resolve, reject) {
    try {
        setTimeout(() => {
            throw new Error("Whoops 111!");
        }, 1000);
    } catch {
        // ä¸å·¥ä½œã€‚
    }
}).catch(alert);
```

ä¸ºäº†æ•è·åˆ°è®¡åˆ’çš„ï¼ˆscheduledï¼‰å‡½æ•°ä¸­çš„å¼‚å¸¸ï¼Œé‚£ä¹ˆ `try...catch` å¿…é¡»åœ¨è¿™ä¸ªå‡½æ•°å†…ï¼š

```javascript
new Promise(function(resolve, reject) {
    setTimeout(() => {
        try {
            throw new Error("Whoops 111!");
        } catch {
            
        }
    }, 1000);
}).catch(alert);
```

è€Œ promise çš„æ‰§è¡Œè€…ï¼ˆexecutorï¼‰å’Œ promise çš„å¤„ç†ç¨‹åºå‘¨å›´çš„ `try..catch` æ˜¯â€œéšå¼çš„â€ã€‚

æ²¡æ³•æ›´æ”¹ä½ç½®ã€‚

â€‹	:arrow_right: å³ï¼šä»»åŠ¡ä¸­éšå¼çš„ `try..catch` ç»“æ„åªèƒ½ã€Œæ•æŠ“ã€åˆ°åŒæ­¥çš„é”™è¯¯

â€‹	:arrow_right: å› æ­¤ï¼Œerror æˆ– å¼‚å¸¸ï¼Œæœªè¢« `try...catch` æ•è·ï¼Œä¹Ÿå°±æ— æ³•è¢«è½¬åŒ–ä¸º rejected promiseï¼Œ`.catch` å°±ä¸€ç›´åœ¨å¹²ç­‰ promise çš„çŠ¶æ€å˜ä¸º settledï¼Œè€Œæ— æ³•è¢«è§¦å‘ã€‚





### 11.5 Promise API

åœ¨ `Promise` ç±»ä¸­ï¼Œæœ‰ä»¥ä¸‹ 6 ç§é™æ€æ–¹æ³•ã€‚

*detail:*

- [[MDN] Promise - Static methods](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise#static_methods)



#### Promise.all





#### Promise.allSettled





#### Promise.race





#### Promise.any





#### Promise.resolve/reject





#### Summary







### 11.6 Promisification







### 11.7 Microtask



#### Microtasks queue





#### Unhandled rejection





#### Summary







### 11.8 async/await

- [MDN JavaScript/Asynchronous/Promises#async_and_await](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Promises#async_and_await) 

#### async functions





#### await





#### Error handling





#### Summary







## 12 - Generators, advanced iteration

## 13 - Modules

## 14 - Miscellaneous

### 14.1 Proxy and Reflect



------

# PART 2 Browser: Document, Events, Interfaces

## 1 - Document

## 2 - Introduction to Events

## 3 - UI Events

## 4 - Forms, controls

## 5 - Document and resource loading

### 5.1 Page: DOMContentLoaded, load, beforeunload, unload

### 5.2 Scripts: async, defer

### 5.3 Resource loading: onload and onerror



## 6 - Miscellaneous



------

# PART 3 Additional articles

## 1 - Frames and windows

## 2 - Binary data, files

## 3 - Network requests



### 3.1 Fetch





### 3.2 FormData





### 3.3 Fetch: Download progress





### 3.4 Fetch: Abort - ä¸­æ­¢





### 3.5 Fetch: Cross-Origin Requests





### 3.6 Fetch API





### 3. 7 URL objects





### 3.8 XMLHttpRequest





### 3.9 Resumable file upload





### 3.10 Long polling - é•¿è½®è¯¢





### 3.11 WebSocket





### 3.12 Server Sent Events





## 4 - Storing data in the browser

https://zh.javascript.info/data-storage

### 4.1 Cookie, document.cookie

### 4.2 LocalStorage, sessionStorage

https://developer.mozilla.org/zh-CN/docs/Web/API/Window/localStorage
https://developer.mozilla.org/zh-CN/docs/Web/API/Window/sessionStorage
https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API



### 4.3 IndexedDB


## 5 - Animation

## 6 - Web components

## 7 - Regular expressions



------

end